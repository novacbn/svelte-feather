{"version":3,"file":"svelte-commons.js","sources":["../../../node_modules/svelte/store/index.mjs","../../../node_modules/svelte-commons/dist/esm/util/shared/url.js","../../../node_modules/svelte-commons/dist/esm/util/browser/location.js","../../../node_modules/svelte-commons/dist/esm/stores/shared/overlay.js","../../../node_modules/svelte-commons/dist/esm/stores/browser/location.js","../../../node_modules/svelte-commons/dist/esm/stores/browser/query_param.js","../../../node_modules/svelte-commons/dist/esm/stores/shared/storage.js","../../../node_modules/svelte-commons/dist/esm/stores/browser/storage.js","../../../node_modules/tv4/tv4.js"],"sourcesContent":["import { noop, safe_not_equal, subscribe, run_all, is_function } from '../internal';\nexport { get_store_value as get } from '../internal';\n\nconst subscriber_queue = [];\n/**\n * Creates a `Readable` store that allows reading by subscription.\n * @param value initial value\n * @param {StartStopNotifier}start start and stop notifications for subscriptions\n */\nfunction readable(value, start) {\n    return {\n        subscribe: writable(value, start).subscribe,\n    };\n}\n/**\n * Create a `Writable` store that allows both updating and reading by subscription.\n * @param {*=}value initial value\n * @param {StartStopNotifier=}start start and stop notifications for subscriptions\n */\nfunction writable(value, start = noop) {\n    let stop;\n    const subscribers = [];\n    function set(new_value) {\n        if (safe_not_equal(value, new_value)) {\n            value = new_value;\n            if (stop) { // store is ready\n                const run_queue = !subscriber_queue.length;\n                for (let i = 0; i < subscribers.length; i += 1) {\n                    const s = subscribers[i];\n                    s[1]();\n                    subscriber_queue.push(s, value);\n                }\n                if (run_queue) {\n                    for (let i = 0; i < subscriber_queue.length; i += 2) {\n                        subscriber_queue[i][0](subscriber_queue[i + 1]);\n                    }\n                    subscriber_queue.length = 0;\n                }\n            }\n        }\n    }\n    function update(fn) {\n        set(fn(value));\n    }\n    function subscribe(run, invalidate = noop) {\n        const subscriber = [run, invalidate];\n        subscribers.push(subscriber);\n        if (subscribers.length === 1) {\n            stop = start(set) || noop;\n        }\n        run(value);\n        return () => {\n            const index = subscribers.indexOf(subscriber);\n            if (index !== -1) {\n                subscribers.splice(index, 1);\n            }\n            if (subscribers.length === 0) {\n                stop();\n                stop = null;\n            }\n        };\n    }\n    return { set, update, subscribe };\n}\nfunction derived(stores, fn, initial_value) {\n    const single = !Array.isArray(stores);\n    const stores_array = single\n        ? [stores]\n        : stores;\n    const auto = fn.length < 2;\n    return readable(initial_value, (set) => {\n        let inited = false;\n        const values = [];\n        let pending = 0;\n        let cleanup = noop;\n        const sync = () => {\n            if (pending) {\n                return;\n            }\n            cleanup();\n            const result = fn(single ? values[0] : values, set);\n            if (auto) {\n                set(result);\n            }\n            else {\n                cleanup = is_function(result) ? result : noop;\n            }\n        };\n        const unsubscribers = stores_array.map((store, i) => subscribe(store, (value) => {\n            values[i] = value;\n            pending &= ~(1 << i);\n            if (inited) {\n                sync();\n            }\n        }, () => {\n            pending |= (1 << i);\n        }));\n        inited = true;\n        sync();\n        return function stop() {\n            run_all(unsubscribers);\n            cleanup();\n        };\n    });\n}\n\nexport { derived, readable, writable };\n","var __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\n/**\n * Represents the Regular Expression to match patterns in route patterns, e.g. `/my/route/:parameter/:names`\n *\n * @internal\n */\nvar ROUTE_PARAMETER_EXPRESSION = /:[^\\s/]+/g;\n/**\n * Returns a pathname matching function, that returns the named parameters in\n * the given pathname if the route matched\n *\n * @internal\n *\n * @param route\n */\nfunction compile_route(route) {\n    // source: https://stackoverflow.com/a/40739605\n    route = normalize_pathname(route);\n    var parameters = [];\n    var expression = new RegExp(\"^\" + route.replace(ROUTE_PARAMETER_EXPRESSION, \"([\\\\w-]+)\") + \"$\");\n    // We need to collect the parameters name from the route pattern in order,\n    // so the matching function return the parsed pathnames as named keys\n    var match;\n    while ((match = ROUTE_PARAMETER_EXPRESSION.exec(route))) {\n        parameters.push(match[0].slice(1));\n    }\n    return function (pathname) {\n        pathname = normalize_pathname(pathname);\n        var match = expression.exec(pathname);\n        if (match) {\n            var _parameters = {};\n            for (var index in parameters) {\n                // `RegExp.exec` returns the matched value as index `0`,\n                // so we need to increment by `1`\n                _parameters[parameters[index]] = match[parseInt(index) + 1];\n            }\n            return _parameters;\n        }\n        return null;\n    };\n}\n/**\n * Returns the sorting for route patterns, sorting longer (more specific) patterns\n * higher than shorter (less specific) patterns\n *\n * @internal\n *\n * @param a\n * @param b\n */\nfunction sort_routes(a, b) {\n    return b[0].length - a[0].length;\n}\n/**\n * Returns a `URL` instance stringified via `.pathname` + `.search` + `.hash`\n *\n * > **NOTE**: Set `include_hash` to `false`, to disable including `.hash` as a postfix\n *\n * ```javascript\n * import {format_url} from \"svelte-commons/lib/util/shared\";\n *\n * const url = new URL(\"https://my.domain/path/to/application?x=2#header-id\");\n *\n * // Here, we're formating it with all three URL components\n * const format_hash = format_url(url);\n * console.log(format_hash); // logs: `/path/to/application?x=2#header-id`\n *\n * // Optionally though. you can disable including the `.hash` component\n * const format_no_hash = format_url(url, false);\n * console.log(format_no_hash); // logs: `/path/to/application?x=2`\n * ```\n *\n * @param url\n * @param include_hash\n */\nexport function format_url(url, include_hash) {\n    if (include_hash === void 0) { include_hash = true; }\n    var hash = url.hash, pathname = url.pathname, search = url.search;\n    if (include_hash)\n        return pathname + search + hash;\n    return pathname + search;\n}\n/**\n * Returns if the `href` is an internal webpage link, e.g. `/path/to/page` or `this/is/a/path`\n *\n * > **RULES**:\n * > - URLs with a protocol, e.g. `https://my.domain/index.html`, are considered external\n * > - URLs that are protocol independent, e.g. `//cdn-provider.com/some_stylesheet.css` are considered external\n *\n * ```javascript\n * import {is_internal_href} from \"svelte-commons/lib/util/shared\";\n *\n * const href = \"/path/to/application?x=1\";\n * const url = \"https://google.com\";\n *\n * console.log(is_internal_href(href)); // logs: `true`\n * console.log(is_internal_href(url)); // logs: `false`\n * ```\n *\n * @param href\n */\nexport function is_internal_href(href) {\n    return !href.match(/^\\w+:\\/\\//) && !href.startsWith(\"//\");\n}\n/**\n * Returns the `a` and `b` URLs joined together naively\n *\n * > **RULES**:\n * > - Protocols, domains, ports are ignored for both URLs\n * > - Hash string, and query parameters are ignored for `a` URL\n * > - `b` URL's hash string and query parameters will be in the resulting URL\n * > - The resulting URL pathname are normalized after being joined\n *\n * ```javascript\n * import {join} from \"svelte-commons/lib/util/shared\";\n *\n * // We're going to join `a` and `b` together, however the protocol and domain will be\n * // dropped from `a`, along with the query parameters\n * const a = \"https://my.domain/path/to/application?x=1\";\n * const b = \"/sub-page?x=2\";\n *\n * const joined = join(a, b);\n *\n * console.log(joined); // logs: `/path/to/application/sub-page?x=2`\n * ```\n *\n * @param a\n * @param b\n */\nexport function join(a, b) {\n    var a_pathname = new URL(a, \"http://localhost\").pathname;\n    var _a = new URL(b, \"http://localhost\"), hash = _a.hash, search = _a.search, b_pathname = _a.pathname;\n    return normalize_pathname(a_pathname + \"/\" + b_pathname) + search + hash;\n}\n/**\n * Returns the normalized version of the `pathname` parameter\n *\n * > **RULES**:\n * > - Backward slashes `\\` are converted to forward slashes `/`\n * > - Consecutive forward slashes `/` are reduced to a single slash\n * > - Forward slashes `/` are trimmed from the beginning and end of the string\n * > - Up directory directives `../` are evaluated, removing it and the parent directory if exists\n * >     - **NOTE**: Parent directories are currently matched to alphanumeric chatacters, periods, spaces, tildes, underscores and dashes\n * >     - **REGEX**: [\\w_\\.\\-\\s~]+\n *\n * ```javascript\n * import {normalize_pathname} from \"svelte-commons/lib/util/shared\";\n *\n * // Below we have a pathname with Windows separators `\\`, consecutive separators `//`, and up directory directives `../`\n * const malformed_pathname = \"\\\\path/to//application/src/../assets\"; // NOTE: `\\\\` renders as `\\`, since `\\` normally escapes in strings\n *\n * const normalized = normalize_pathname(malformed_pathname);\n *\n * console.log(normalized); // logs: `/path/to/application/assets`\n * ```\n *\n * @param pathname\n */\nexport function normalize_pathname(pathname) {\n    return pathname\n        .replace(/\\\\+/g, \"/\")\n        .replace(/[\\/\\/]+/g, \"/\")\n        .replace(/([\\w_\\.\\-\\s~]+\\/)?(\\.\\.\\/)/g, \"\")\n        .replace(/^\\/+/, \"\")\n        .replace(/\\/+$/, \"\");\n}\n/**\n * Returns a query string parsed into a key-value mapping\n *\n * ```javascript\n * import {parse_query} from \"svelte-commons/lib/util/shared\";\n *\n * const query_string = \"?sorting=ASCENDING&remove-inactive\";\n *\n * const mapping = parse_query(query_string);\n *\n * console.log(mapping); logs: `{\"sorting\": \"ASCENDING\", \"remove-inactive\": true}`\n * ```\n *\n * @param query\n */\nexport function parse_query(query) {\n    if (typeof query === \"string\")\n        query = new URLSearchParams(query);\n    else if (query instanceof URL)\n        query = query.searchParams;\n    var entries = Array.from(query.entries(), function (_a) {\n        var _b = __read(_a, 2), key = _b[0], value = _b[1];\n        // Since boolean query parameters, e.g. `?x=` / `?x`, have no value, we need to them to `true`\n        if (value)\n            return [key, value];\n        return [key, true];\n    });\n    // NOTE: Just to increase supported Browsers, e.g. pre-Chromium Microsoft Edge, using a `.reduce` instead of `Object.fromEntries`\n    return entries.reduce(function (accum, _a) {\n        var _b = __read(_a, 2), key = _b[0], value = _b[1];\n        accum[key] = value;\n        return accum;\n    }, {});\n}\n/**\n * Returns a function that matches parameterized routes, returning the assigned values and parsed parameters\n *\n * ```javascript\n * import {make_router} from \"svelte-commons/lib/util/shared\";\n *\n * import ComponentOne from \"...\";\n * import ComponentTwo from \"...\";\n *\n * // Below, we're defining our route mappings, along with their assigned Svelte Components\n * const routes = {\n *     \"/\": ComponentOne,\n *     \"/items/:id\": ComponentTwo\n * };\n *\n * // Now we feed our mappings into the factory function, which gives us a matcher function\n * const router = make_router(routes);\n *\n * // First, let's try matching our first route\n * console.log(router(\"/\")); // logs: `[{}, ComponentOne]`\n *\n * // Next, let's try matching our second route\n * console.log(router(\"/items/blue-jeans\")); // logs: `[{id: \"blue-jeans\"}, ComponentTwo]`\n *\n * // Finally, we can see that if we pass an invalid route, `null` is returned. Which should\n * // be treated the same as a \"404\"\n * console.log(router(\"/some/invalid/route\")); // logs: `null`\n * ```\n *\n * @param routes\n * @param base\n */\nexport function make_router(routes, base) {\n    if (base === void 0) { base = \"\"; }\n    // source: https://stackoverflow.com/a/40739605\n    var route_entries = Object.entries(routes);\n    route_entries = route_entries.sort(sort_routes);\n    var compiled_routes = route_entries.map(function (_a) {\n        var _b = __read(_a, 2), route = _b[0], Component = _b[1];\n        // Add support for end-developers passing a base URL, e.g. `https://my.domain/path/to/application`\n        if (base)\n            route = join(base, route);\n        var match = compile_route(route);\n        return [route, match, Component];\n    });\n    return function (pathname) {\n        var e_1, _a;\n        try {\n            for (var compiled_routes_1 = __values(compiled_routes), compiled_routes_1_1 = compiled_routes_1.next(); !compiled_routes_1_1.done; compiled_routes_1_1 = compiled_routes_1.next()) {\n                var _b = __read(compiled_routes_1_1.value, 3), route = _b[0], match = _b[1], Component = _b[2];\n                var parameters = match(pathname);\n                if (parameters)\n                    return [parameters, Component];\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (compiled_routes_1_1 && !compiled_routes_1_1.done && (_a = compiled_routes_1.return)) _a.call(compiled_routes_1);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        return null;\n    };\n}\n//# sourceMappingURL=url.js.map","import { format_url, is_internal_href, join } from \"../shared/url\";\n/**\n * Returns the options passable into [[goto]], with standard defaults\n *\n * @internal\n *\n * @param options\n */\nfunction GotoOptions(options) {\n    if (options === void 0) { options = {}; }\n    var _a = options.base_url, base_url = _a === void 0 ? \"\" : _a, _b = options.hash, hash = _b === void 0 ? false : _b, _c = options.replace, replace = _c === void 0 ? false : _c;\n    return { base_url: base_url, hash: hash, replace: replace };\n}\n/**\n * Return a new `URL` instance, based off the current Browser `Location`\n *\n * > **NOTE**: Set `hash` to `true`, to parse the current `Location.hash` as the URL\n *\n * @internal\n *\n * @param hash\n */\nexport function get_location_url(hash) {\n    if (hash === void 0) { hash = false; }\n    if (hash) {\n        var href = location.hash.slice(1);\n        return new URL(href, location.origin);\n    }\n    return new URL(location);\n}\n/**\n * Updates the current Browser `Location` with a given `URL` instance, using its `.hash`, `.pathname`, and `.search` components\n *\n * > **NOTE**: Set `hash` to `true`, to set `Location.hash` as the URL\n *\n * @internal\n *\n * @param url\n * @param hash\n * @param replace\n */\nexport function update_location_url(url, hash, replace) {\n    if (hash === void 0) { hash = false; }\n    if (replace === void 0) { replace = false; }\n    var href;\n    if (hash)\n        href = format_url(location, false) + \"#\" + format_url(url);\n    else\n        href = format_url(url);\n    if (replace)\n        history.replaceState(null, \"\", href);\n    else\n        history.pushState(null, \"\", href);\n    // We need to trigger the `popstate` event, so any listener can update, e.g. `router` Store.\n    var state = history.state;\n    var event = new PopStateEvent(\"popstate\", { state: state });\n    window.dispatchEvent(event);\n}\n/**\n * Progammatically navigates the Browser to the given `href`, and pushes a new History state\n *\n * > **NOTE**: If your `<head>` element contains a [`<base>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/base) element, [[goto]] will read it as the base url\n *\n * As a simple example:\n *\n * ```javascript\n * import {goto} from \"svelte-commons/lib/util/browser\";\n *\n * // Navigate to a page decending from the current origin\n * goto(\"/shopping-cart/item-274\");\n *\n * // Similar to above, by updates the Browser's hash string instead\n * goto(\"/shopping-cart/item-274\", {hash: true});\n * ```\n *\n * You can also replace the current History state:\n *\n * ```javascript\n * import {goto} from \"svelte-commons/lib/util/browser\";\n *\n * // Same above, but replacing current History state\n * goto(\"/shopping-cart/item-274\", {replace: true});\n * ```\n *\n * Finally, you can navigate to entirely different websites:\n *\n * ```javascript\n * import {goto} from \"svelte-commons/lib/util/browser\";\n *\n * // This will cause a full page reload while navigating\n * goto(\"https://google.com\");\n * ```\n * @param href\n * @param options\n */\nexport function goto(href, options) {\n    if (!is_internal_href(href)) {\n        var url_1 = new URL(href);\n        // If the `href` doesn't have a matching origin, we can just do a full page navigation\n        // to it, otherwise we just need to extract the exact everything after the origin\n        if (url_1.origin !== location.origin)\n            location.href = href;\n        else\n            href = format_url(url_1);\n    }\n    var _a = GotoOptions(options), base_url = _a.base_url, hash = _a.hash, replace = _a.replace;\n    // We need to have the Browser process the URL, so properly URL directives are followed\n    // e.g. `/absolute/path`, `./relative/path`, `../directory/up/path`, etc...\n    var url = new URL(href, get_location_url(hash).href);\n    // We need to support passable base urls overrides here\n    if (base_url)\n        url.pathname = join(base_url, url.pathname);\n    else if (!hash) {\n        // We can also support non-hash mode base urls via `<base href=\"XXX\" />` in `<head>`\n        if (location.href !== document.baseURI) {\n            var pathname = new URL(document.baseURI).pathname;\n            url.pathname = join(pathname, url.pathname);\n        }\n    }\n    update_location_url(url, hash, replace);\n}\n//# sourceMappingURL=location.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\n/**\n * Returns a new `Writable` Svelte Store that has it's I/O overlaid with the `read` function for `.subscribe` / `.update` and `.write` function for `.set` / `.update`\n *\n * ```javascript\n * import {writable} from \"svelte/store\";\n *\n * import {overlay} from \"svelte-commons/lib/stores/shared/overlay\";\n *\n * // For the base Store, it's going to maintain the JSON-encoded view of data\n * // passed in. So we need to default it to an empty string\n * const raw_store = writable(\"\");\n *\n * // Here, we're creating a `Writable` \"overlay\" Store, which will encode all\n * // inputs to JSON before writing to the base Store. And then parse all values\n * // from the base Store as JSON, for subscriptions and updater functions\n * const store = overlay(\n *     raw_store,\n *     (value) => JSON.parse(value),\n *     (value) => JSON.stringify(value)\n * );\n *\n * raw_store.subscribe(console.log); // logs: ``\n *\n * // As you can see when `.set` is ran, our base Store's logger\n * // shows the JSON-encoded data\n * store.set({hello: \"world\"}); // logs: `{\"hello\":\"world\"}`\n * ```\n *\n * @param store\n * @param read\n * @param write\n */\nexport function overlay(store, read, write) {\n    var set = store.set, subscribe = store.subscribe, update = store.update;\n    return __assign(__assign({}, store), { set: function (value) {\n            value = write(value);\n            set(value);\n        },\n        subscribe: function (run, invalidate) {\n            var _run = function (value) {\n                value = read(value);\n                run(value);\n            };\n            return subscribe(_run, invalidate);\n        },\n        update: function (updater) {\n            update(function (value) {\n                value = read(value);\n                value = updater(value);\n                return write(value);\n            });\n        } });\n}\n//# sourceMappingURL=overlay.js.map","import { readable, writable } from \"svelte/store\";\nimport { get_location_url, update_location_url } from \"../../util/browser/location\";\nimport { overlay } from \"../shared/overlay\";\n/**\n * Returns the options passable into the [[hash]], [[pathname]], or [[search]] Svelte Stores, with standard defaults\n *\n * @internal\n *\n * @param options\n */\nfunction LocationOptions(options) {\n    if (options === void 0) { options = {}; }\n    var _a = options.hash, hash = _a === void 0 ? false : _a, _b = options.readonly, readonly = _b === void 0 ? false : _b, _c = options.replace, replace = _c === void 0 ? false : _c;\n    return { hash: hash, readonly: readonly, replace: replace };\n}\n/**\n * Returns a factory function, for binding a [`Location`](https://developer.mozilla.org/en-US/docs/Web/API/Location) component into a `Writable` Svelte Store\n *\n * @internal\n *\n * @param component\n */\nfunction make_location_store(component) {\n    return function (options) {\n        var _a = LocationOptions(options), hash = _a.hash, readonly = _a.readonly, replace = _a.replace;\n        function get_value() {\n            var url = get_location_url(hash);\n            return url[component];\n        }\n        function on_start(set) {\n            function on_popstate(event) {\n                set(get_value());\n            }\n            set(get_value());\n            window.addEventListener(\"popstate\", on_popstate);\n            return function () {\n                window.removeEventListener(\"popstate\", on_popstate);\n            };\n        }\n        if (readonly)\n            return readable(get_value(), on_start);\n        function set_value(value) {\n            var url = get_location_url(hash);\n            url[component] = value;\n            update_location_url(url, hash, replace);\n        }\n        var store = writable(get_value(), on_start);\n        return overlay(store, function (value) { return value; }, function (value) {\n            set_value(value);\n            return value;\n        });\n    };\n}\n/**\n * Returns a `Writable` Svelte Store, which binds to the [`Location.hash`](https://developer.mozilla.org/en-US/docs/Web/API/Location/hash) component\n *\n * In normal mode, which parses the current Browser URL normally:\n *\n * ```html\n * <script>\n *     import {hash} from \"svelte-commons/lib/stores/browser\";\n *\n *     const store = hash();\n * </script>\n *\n * <!-- e.g. Browser URL of `https://my.domain/path/to/application#I-am-a-hash` is `#I-am-a-hash` -->\n * Current hash string is: <span style=\"color:red;\">{$store}</span>!\n * ```\n *\n * In hash mode, which parses current Browser URL's hash string **AS** the URL:\n *\n * ```html\n * <script>\n *     import {hash} from \"svelte-commons/lib/stores/browser\";\n *\n *     const store = hash({hash: true});\n * </script>\n *\n * <!-- e.g. Browser URL of `https://my.domain/#/path/to/application#I-am-a-hash` is `#I-am-a-hash` -->\n * Current hash string is: <span style=\"color:red;\">{$store}</span>!\n * ```\n *\n * You can also update the Store to change the hash, along with making it replace current History entry:\n *\n * ```html\n * <script>\n *     import {hash} from \"svelte-commons/lib/stores/browser\";\n *\n *     // By passing `ILocationOptions.replace`, changes wont create new History\n *     // entries, e.g. more entries for Back / Forward Button\n *     const store = hash({replace: true});\n * </script>\n *\n * <!-- e.g. Browser URL of `https://my.domain/path/to/application` will update to `https://my.domain/path/to/application#I-am-a-hash` -->\n * <a on:click|preventDefault={() => $store = \"#I-am-a-hash\"}>Click me</a> to change the hash string!\n * ```\n *\n * @param options\n */\nexport var hash = make_location_store(\"hash\");\n/**\n * Returns a `Writable` Svelte Store, which binds to the [`Location.pathname`](https://developer.mozilla.org/en-US/docs/Web/API/Location/pathname) component\n *\n * In normal mode, which parses the current Browser URL normally:\n *\n * ```html\n * <script>\n *     import {pathname} from \"svelte-commons/lib/stores/browser\";\n *\n *     const store = pathname();\n * </script>\n *\n * <!-- e.g. Browser URL of `https://my.domain/path/to/application` is `/path/to/application` -->\n * Current pathname is: <span style=\"color:red;\">{$store}</span>!\n * ```\n *\n * In hash mode, which parses current Browser URL's hash string **AS** the URL:\n *\n * ```html\n * <script>\n *     import {pathname} from \"svelte-commons/lib/stores/browser\";\n *\n *     const store = pathname({hash: true});\n * </script>\n *\n * <!-- e.g. Browser URL of `https://my.domain/#/path/to/application` is `/path/to/application` -->\n * Current pathname is: <span style=\"color:red;\">{$store}</span>!\n * ```\n *\n * You can also update the Store to change the pathname, along with making it replace current History entry:\n *\n * ```html\n * <script>\n *     import {pathname} from \"svelte-commons/lib/stores/browser\";\n *\n *     // By passing `ILocationOptions.replace`, changes wont create new History\n *     // entries, e.g. more entries for Back / Forward Button\n *     const store = pathname({replace: true});\n * </script>\n *\n * <!-- e.g. Browser URL of `https://my.domain/path/to/application` will update to `https://my.domain/path/to/other-application` -->\n * <a on:click|preventDefault={() => $store = \"/path/to/other-application\"}>Click me</a> to change the pathname!\n * ```\n *\n * @param options\n */\nexport var pathname = make_location_store(\"pathname\");\n/**\n * Returns a `Writable` Svelte Store, which binds to the [`Location.search`](https://developer.mozilla.org/en-US/docs/Web/API/Location/search) component\n *\n * In normal mode, which parses the current Browser URL normally:\n *\n * ```html\n * <script>\n *     import {search} from \"svelte-commons/lib/stores/browser\";\n *\n *     const store = search();\n * </script>\n *\n * <!-- e.g. Browser URL of `https://my.domain/path/to/application?x=1` is `?x=1` -->\n * Current query string is: <span style=\"color:red;\">{$store}</span>!\n * ```\n *\n * In hash mode, which parses current Browser URL's hash string **AS** the URL:\n *\n * ```html\n * <script>\n *     import {search} from \"svelte-commons/lib/stores/browser\";\n *\n *     const store = search({hash: true});\n * </script>\n *\n * <!-- e.g. Browser URL of `https://my.domain/#/path/to/application?x=1` is `?x=1` -->\n * Current query string is: <span style=\"color:red;\">{$store}</span>!\n * ```\n *\n * You can also update the Store to change the query string, along with making it replace current History entry:\n *\n * ```html\n * <script>\n *     import {search} from \"svelte-commons/lib/stores/browser\";\n *\n *     // By passing `ILocationOptions.replace`, changes wont create new History\n *     // entries, e.g. more entries for Back / Forward Button\n *     const store = search({replace: true});\n * </script>\n *\n * <!-- e.g. Browser URL of `https://my.domain/path/to/application` will update to `https://my.domain/path/to/application?x=1` -->\n * <a on:click|preventDefault={() => $store = \"?x=1\"}>Click me</a> to change the query string!\n * ```\n *\n * @param options\n */\nexport var search = make_location_store(\"search\");\n//# sourceMappingURL=location.js.map","import { get_location_url } from \"../../util/browser/location\";\nimport { overlay } from \"../shared/overlay\";\nimport { search } from \"./location\";\n/**\n * Returns the options passable into the [[query_param]] Svelte Store, with standard defaults\n *\n * @internal\n *\n * @param options\n */\nfunction QueryParamOptions(options) {\n    if (options === void 0) { options = {}; }\n    var _a = options.hash, hash = _a === void 0 ? false : _a, _b = options.replace, replace = _b === void 0 ? false : _b;\n    return { hash: hash, replace: replace };\n}\n/**\n * Returns a `Writable` Svelte Store, which binds to a specific query string parameter\n *\n * ```javascript\n * <script context=\"module\">\n *     const SORTING_MODES = {\n *         ascending: \"ASCENDING\",\n *         decending: \"DECENDING\"\n *     };\n * </script>\n *\n * <script>\n *     import {query_param} from \"svelte-commons/lib/stores/browser\";\n *\n *     // By providing `SORTING_MODES.ascending` as the default, that means whenever `?sorting=` is missing,\n *     // then the Store will output `ASCENDING`\n *     const store = query_param(\"sorting\", SORTING_MODES.ascending);\n *\n *     const movie_titles = [\"Golden Eye\", \"Blade Runner\", \"Star Wars: Episode I - The Phantom Menace\"];\n *\n *     let sorted;\n *     $: {\n *         sorted = [...movie_titles];\n *         sorted.sort();\n *\n *         if ($store === SORTING_MODES.decending) sorted.reverse();\n *     }\n * </script>\n *\n * <!-- Below will erase `?sorting=` from the URL, since `SORTING_MODES.ascending` is our default -->\n * Change to: <a on:click|preventDefault={() => $store = SORTING_MODES.ascending}>ASCENDING</a><br />\n *\n * <!-- Below will add `?sorting=DECENDING` to the URL -->\n * Change to: <a on:click|preventDefault={() => $store = SORTING_MODES.decending}>DECENDING</a><br />\n *\n * <h2>Movie Titles:</h2>\n *\n * <ul>\n *     {#each sorted as title}\n *         <li>{title}</li>\n *     {/each}\n * </ul>\n * ```\n *\n * @param key\n * @param default_value\n * @param options\n */\nexport function query_param(key, default_value, options) {\n    if (options === void 0) { options = {}; }\n    var _a = QueryParamOptions(options), hash = _a.hash, replace = _a.replace;\n    var store = search({ hash: hash, replace: replace });\n    return overlay(store, \n    // @ts-ignore\n    function (value) {\n        var params = new URLSearchParams(value);\n        // If the end-developer specified that the query parameter was a boolean, only the existance of the key should be returned\n        if (typeof default_value === \"boolean\")\n            return params.has(key);\n        // If the query parameter is a string, and it is not set, return the default\n        if (params.has(key))\n            return params.get(key);\n        return default_value;\n    }, function (value) {\n        var url = get_location_url(hash);\n        var params = url.searchParams;\n        if (typeof default_value === \"boolean\") {\n            // If the end-developer specified that the query parameter was a boolean, then we need to set if truthy\n            if (value)\n                params.set(key, \"\");\n            else\n                params.delete(key);\n        }\n        else {\n            // If the query parameter is a string, then we set it, if the string is not empty or doesn't equal default\n            if (!value || value === default_value)\n                params.delete(key);\n            else\n                params.set(key, value);\n        }\n        // HACK: When boolean query parameters are set via `URLSearchParams.set`, they render as `?my_key=`, but we expect\n        // rendering as `?my_key`. So we need to fix that\n        return params\n            .toString()\n            .replace(/=&/g, \"&\")\n            .replace(/=$/g, \"\");\n    });\n}\n//# sourceMappingURL=query_param.js.map","var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { writable } from \"svelte/store\";\nimport { overlay } from \"./overlay\";\n/**\n * Returns the standardized defaults for options passed into `storage` Store\n *\n * @internal\n *\n * @param options\n */\nfunction StorageOptions(options) {\n    if (options === void 0) { options = {}; }\n    return __assign({ event: undefined, event_source: undefined, prefix: \"svelte-commons.\" }, options);\n}\n/**\n * Returns a `Readable` (Server) / `Writable` (Browser) Svelte Store with a reactive binding to a given `Storage` adapter\n *\n * > **NOTE**: Only **JSON-compatible** values are supported\n *\n * As a semi-complete example:\n *\n * ```javascript\n * import {get} from \"svelte/store\";\n *\n * import {storage} from \"svelte-commons/lib/stores/browser\";\n *\n * // Below, creating a factory function wrapper around the `localStorage` Web Storage API\n * const local_storage = storage(window.localStorage, {\n *     // Both `event` and `event_source` tells the Store what event string to\n *     // listen to and what `EventTarget` to listen from for tab-sync\n *     event: \"storage\",\n *     event_source: window,\n *\n *     // `.prefix` tells the Store to prefix all storage keys with a specific string (defaults to `svelte-commons.`)\n *     prefix: \"my_key_prefix.\"\n * });\n *\n * // Now we can use our new `local_storage` factory to make a reactive Store binding\n * // to a specific `localStorage` key.\n * const store = local_storage(\"my_string_key\", \"I am default\");\n *\n * // Using `get`, we can see the Store is already at its default\n * console.log(get(store)); // logs: `I am default`\n *\n * // Since there is nothing set yet, the actual localStorage key is empty\n * console.log(window.localStorage.getItem(\"my_key_prefix.my_string_key\")) // logs: `null`\n *\n * // After setting a value, both the Store and `localStorage` have the same value\n * store.set(\"But, this is not default\");\n * console.log(\n *     get(store),\n *     window.localStorage.getItem(\"my_key_prefix.my_string_key\")\n * ); // logs: `But, this is not default`, `\"But, this is not default\"`\n *\n * // By setting the Store to the default value OR `undefined`, the\n * // `localStorage` item is removed\n * store.set(\"I am default\");\n *\n * console.log(\n *     get(store),\n *     window.localStorage.getItem(\"my_key_prefix.my_string_key\")\n * ); // logs: `I am default`, `null`\n * ```\n *\n * @param adapter\n * @param options\n */\nexport function storage(adapter, options) {\n    if (options === void 0) { options = {}; }\n    var _a = StorageOptions(options), event = _a.event, event_source = _a.event_source, prefix = _a.prefix;\n    return function (key, default_value) {\n        if (prefix)\n            key = prefix + key;\n        var stored_value = adapter.getItem(key);\n        var parsed_value = stored_value ? JSON.parse(stored_value) : default_value;\n        var store = writable(parsed_value, function (set) {\n            var _a;\n            function on_change(event) {\n                event: StorageEvent = event.detail ? event.detail : event;\n                if (event.storageArea !== adapter || event.key !== key)\n                    return;\n                if (event.newValue)\n                    set(JSON.parse(event.newValue));\n                else\n                    set(default_value);\n            }\n            if (event) {\n                (_a = event_source) === null || _a === void 0 ? void 0 : _a.addEventListener(event, on_change);\n                return function () { var _a; return (_a = event_source) === null || _a === void 0 ? void 0 : _a.removeEventListener(event, on_change); };\n            }\n        });\n        return overlay(store, function (value) { return value; }, function (value) {\n            if (typeof value === \"undefined\")\n                value = default_value;\n            if (value === default_value)\n                adapter.removeItem(key);\n            else\n                adapter.setItem(key, JSON.stringify(value));\n            return value;\n        });\n    };\n}\n//# sourceMappingURL=storage.js.map","import { storage } from \"../shared/storage\";\n/**\n * Represents the current global object, Window (Browser) / Global (Server)\n */\nvar global = typeof window !== \"undefined\" ? window : this;\n/**\n * Returns a `storage` Svelte Store with a reactive binding to `window.localStorage`\n *\n * NOTE: Only **JSON-compatible** values are supported\n *\n * As a minimal example:\n *\n * ```javascript\n * import {local_storage} from \"svelte-commons/lib/stores/browser\";\n *\n * const store = local_storage(\"my_string_key\", \"some default string\");\n *\n * store.subscribe((value) => {\n *     console.log(value);\n * }); // Will log any changes to the Store\n *\n * store.set(\"a non-default string\"); // logs: `a non-default string`\n *\n * console.log(\n *     window.localStorage.getItem(\"svelte-commons.my_string_key\")\n * ); // logs: `\"a non-default string\"`\n * ```\n */\nexport var local_storage = global.localStorage\n    ? storage(global.localStorage, {\n        event: \"storage\",\n        event_source: global\n    })\n    : null;\n/**\n * Returns a `storage` Svelte Store with a reactive binding to `window.sessionStorage`\n *\n * NOTE: Only **JSON-compatible** values are supported\n *\n * As a minimal example:\n *\n * ```javascript\n * import {session_storage} from \"svelte-commons/lib/stores/browser\";\n *\n * const store = session_storage(\"my_string_key\", \"some default string\");\n *\n * store.subscribe((value) => {\n *     console.log(value);\n * }); // Will log any changes to the Store\n *\n * store.set(\"a non-default string\"); // logs: `a non-default string`\n *\n * console.log(\n *     window.sessionStorage.getItem(\"svelte-commons.my_string_key\")\n * ); // logs: `\"a non-default string\"`\n * ```\n */\nexport var session_storage = global.sessionStorage\n    ? storage(global.sessionStorage, {\n        event: \"storage\",\n        event_source: global\n    })\n    : null;\n//# sourceMappingURL=storage.js.map","/*\r\nAuthor: Geraint Luff and others\r\nYear: 2013\r\n\r\nThis code is released into the \"public domain\" by its author(s).  Anybody may use, alter and distribute the code without restriction.  The author makes no guarantees, and takes no liability of any kind for use of this code.\r\n\r\nIf you find a bug or make an improvement, it would be courteous to let the author know, but it is not compulsory.\r\n*/\r\n(function (global, factory) {\r\n  if (typeof define === 'function' && define.amd) {\r\n    // AMD. Register as an anonymous module.\r\n    define([], factory);\r\n  } else if (typeof module !== 'undefined' && module.exports){\r\n    // CommonJS. Define export.\r\n    module.exports = factory();\r\n  } else {\r\n    // Browser globals\r\n    global.tv4 = factory();\r\n  }\r\n}(this, function () {\r\n\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FObject%2Fkeys\r\nif (!Object.keys) {\r\n\tObject.keys = (function () {\r\n\t\tvar hasOwnProperty = Object.prototype.hasOwnProperty,\r\n\t\t\thasDontEnumBug = !({toString: null}).propertyIsEnumerable('toString'),\r\n\t\t\tdontEnums = [\r\n\t\t\t\t'toString',\r\n\t\t\t\t'toLocaleString',\r\n\t\t\t\t'valueOf',\r\n\t\t\t\t'hasOwnProperty',\r\n\t\t\t\t'isPrototypeOf',\r\n\t\t\t\t'propertyIsEnumerable',\r\n\t\t\t\t'constructor'\r\n\t\t\t],\r\n\t\t\tdontEnumsLength = dontEnums.length;\r\n\r\n\t\treturn function (obj) {\r\n\t\t\tif (typeof obj !== 'object' && typeof obj !== 'function' || obj === null) {\r\n\t\t\t\tthrow new TypeError('Object.keys called on non-object');\r\n\t\t\t}\r\n\r\n\t\t\tvar result = [];\r\n\r\n\t\t\tfor (var prop in obj) {\r\n\t\t\t\tif (hasOwnProperty.call(obj, prop)) {\r\n\t\t\t\t\tresult.push(prop);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (hasDontEnumBug) {\r\n\t\t\t\tfor (var i=0; i < dontEnumsLength; i++) {\r\n\t\t\t\t\tif (hasOwnProperty.call(obj, dontEnums[i])) {\r\n\t\t\t\t\t\tresult.push(dontEnums[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t};\r\n\t})();\r\n}\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create\r\nif (!Object.create) {\r\n\tObject.create = (function(){\r\n\t\tfunction F(){}\r\n\r\n\t\treturn function(o){\r\n\t\t\tif (arguments.length !== 1) {\r\n\t\t\t\tthrow new Error('Object.create implementation only accepts one parameter.');\r\n\t\t\t}\r\n\t\t\tF.prototype = o;\r\n\t\t\treturn new F();\r\n\t\t};\r\n\t})();\r\n}\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FArray%2FisArray\r\nif(!Array.isArray) {\r\n\tArray.isArray = function (vArg) {\r\n\t\treturn Object.prototype.toString.call(vArg) === \"[object Array]\";\r\n\t};\r\n}\r\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf?redirectlocale=en-US&redirectslug=JavaScript%2FReference%2FGlobal_Objects%2FArray%2FindexOf\r\nif (!Array.prototype.indexOf) {\r\n\tArray.prototype.indexOf = function (searchElement /*, fromIndex */ ) {\r\n\t\tif (this === null) {\r\n\t\t\tthrow new TypeError();\r\n\t\t}\r\n\t\tvar t = Object(this);\r\n\t\tvar len = t.length >>> 0;\r\n\r\n\t\tif (len === 0) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tvar n = 0;\r\n\t\tif (arguments.length > 1) {\r\n\t\t\tn = Number(arguments[1]);\r\n\t\t\tif (n !== n) { // shortcut for verifying if it's NaN\r\n\t\t\t\tn = 0;\r\n\t\t\t} else if (n !== 0 && n !== Infinity && n !== -Infinity) {\r\n\t\t\t\tn = (n > 0 || -1) * Math.floor(Math.abs(n));\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (n >= len) {\r\n\t\t\treturn -1;\r\n\t\t}\r\n\t\tvar k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);\r\n\t\tfor (; k < len; k++) {\r\n\t\t\tif (k in t && t[k] === searchElement) {\r\n\t\t\t\treturn k;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn -1;\r\n\t};\r\n}\r\n\r\n// Grungey Object.isFrozen hack\r\nif (!Object.isFrozen) {\r\n\tObject.isFrozen = function (obj) {\r\n\t\tvar key = \"tv4_test_frozen_key\";\r\n\t\twhile (obj.hasOwnProperty(key)) {\r\n\t\t\tkey += Math.random();\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tobj[key] = true;\r\n\t\t\tdelete obj[key];\r\n\t\t\treturn false;\r\n\t\t} catch (e) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t};\r\n}\r\n// Based on: https://github.com/geraintluff/uri-templates, but with all the de-substitution stuff removed\r\n\r\nvar uriTemplateGlobalModifiers = {\r\n\t\"+\": true,\r\n\t\"#\": true,\r\n\t\".\": true,\r\n\t\"/\": true,\r\n\t\";\": true,\r\n\t\"?\": true,\r\n\t\"&\": true\r\n};\r\nvar uriTemplateSuffices = {\r\n\t\"*\": true\r\n};\r\n\r\nfunction notReallyPercentEncode(string) {\r\n\treturn encodeURI(string).replace(/%25[0-9][0-9]/g, function (doubleEncoded) {\r\n\t\treturn \"%\" + doubleEncoded.substring(3);\r\n\t});\r\n}\r\n\r\nfunction uriTemplateSubstitution(spec) {\r\n\tvar modifier = \"\";\r\n\tif (uriTemplateGlobalModifiers[spec.charAt(0)]) {\r\n\t\tmodifier = spec.charAt(0);\r\n\t\tspec = spec.substring(1);\r\n\t}\r\n\tvar separator = \"\";\r\n\tvar prefix = \"\";\r\n\tvar shouldEscape = true;\r\n\tvar showVariables = false;\r\n\tvar trimEmptyString = false;\r\n\tif (modifier === '+') {\r\n\t\tshouldEscape = false;\r\n\t} else if (modifier === \".\") {\r\n\t\tprefix = \".\";\r\n\t\tseparator = \".\";\r\n\t} else if (modifier === \"/\") {\r\n\t\tprefix = \"/\";\r\n\t\tseparator = \"/\";\r\n\t} else if (modifier === '#') {\r\n\t\tprefix = \"#\";\r\n\t\tshouldEscape = false;\r\n\t} else if (modifier === ';') {\r\n\t\tprefix = \";\";\r\n\t\tseparator = \";\";\r\n\t\tshowVariables = true;\r\n\t\ttrimEmptyString = true;\r\n\t} else if (modifier === '?') {\r\n\t\tprefix = \"?\";\r\n\t\tseparator = \"&\";\r\n\t\tshowVariables = true;\r\n\t} else if (modifier === '&') {\r\n\t\tprefix = \"&\";\r\n\t\tseparator = \"&\";\r\n\t\tshowVariables = true;\r\n\t}\r\n\r\n\tvar varNames = [];\r\n\tvar varList = spec.split(\",\");\r\n\tvar varSpecs = [];\r\n\tvar varSpecMap = {};\r\n\tfor (var i = 0; i < varList.length; i++) {\r\n\t\tvar varName = varList[i];\r\n\t\tvar truncate = null;\r\n\t\tif (varName.indexOf(\":\") !== -1) {\r\n\t\t\tvar parts = varName.split(\":\");\r\n\t\t\tvarName = parts[0];\r\n\t\t\ttruncate = parseInt(parts[1], 10);\r\n\t\t}\r\n\t\tvar suffices = {};\r\n\t\twhile (uriTemplateSuffices[varName.charAt(varName.length - 1)]) {\r\n\t\t\tsuffices[varName.charAt(varName.length - 1)] = true;\r\n\t\t\tvarName = varName.substring(0, varName.length - 1);\r\n\t\t}\r\n\t\tvar varSpec = {\r\n\t\t\ttruncate: truncate,\r\n\t\t\tname: varName,\r\n\t\t\tsuffices: suffices\r\n\t\t};\r\n\t\tvarSpecs.push(varSpec);\r\n\t\tvarSpecMap[varName] = varSpec;\r\n\t\tvarNames.push(varName);\r\n\t}\r\n\tvar subFunction = function (valueFunction) {\r\n\t\tvar result = \"\";\r\n\t\tvar startIndex = 0;\r\n\t\tfor (var i = 0; i < varSpecs.length; i++) {\r\n\t\t\tvar varSpec = varSpecs[i];\r\n\t\t\tvar value = valueFunction(varSpec.name);\r\n\t\t\tif (value === null || value === undefined || (Array.isArray(value) && value.length === 0) || (typeof value === 'object' && Object.keys(value).length === 0)) {\r\n\t\t\t\tstartIndex++;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (i === startIndex) {\r\n\t\t\t\tresult += prefix;\r\n\t\t\t} else {\r\n\t\t\t\tresult += (separator || \",\");\r\n\t\t\t}\r\n\t\t\tif (Array.isArray(value)) {\r\n\t\t\t\tif (showVariables) {\r\n\t\t\t\t\tresult += varSpec.name + \"=\";\r\n\t\t\t\t}\r\n\t\t\t\tfor (var j = 0; j < value.length; j++) {\r\n\t\t\t\t\tif (j > 0) {\r\n\t\t\t\t\t\tresult += varSpec.suffices['*'] ? (separator || \",\") : \",\";\r\n\t\t\t\t\t\tif (varSpec.suffices['*'] && showVariables) {\r\n\t\t\t\t\t\t\tresult += varSpec.name + \"=\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(value[j]).replace(/!/g, \"%21\") : notReallyPercentEncode(value[j]);\r\n\t\t\t\t}\r\n\t\t\t} else if (typeof value === \"object\") {\r\n\t\t\t\tif (showVariables && !varSpec.suffices['*']) {\r\n\t\t\t\t\tresult += varSpec.name + \"=\";\r\n\t\t\t\t}\r\n\t\t\t\tvar first = true;\r\n\t\t\t\tfor (var key in value) {\r\n\t\t\t\t\tif (!first) {\r\n\t\t\t\t\t\tresult += varSpec.suffices['*'] ? (separator || \",\") : \",\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfirst = false;\r\n\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(key).replace(/!/g, \"%21\") : notReallyPercentEncode(key);\r\n\t\t\t\t\tresult += varSpec.suffices['*'] ? '=' : \",\";\r\n\t\t\t\t\tresult += shouldEscape ? encodeURIComponent(value[key]).replace(/!/g, \"%21\") : notReallyPercentEncode(value[key]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (showVariables) {\r\n\t\t\t\t\tresult += varSpec.name;\r\n\t\t\t\t\tif (!trimEmptyString || value !== \"\") {\r\n\t\t\t\t\t\tresult += \"=\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (varSpec.truncate != null) {\r\n\t\t\t\t\tvalue = value.substring(0, varSpec.truncate);\r\n\t\t\t\t}\r\n\t\t\t\tresult += shouldEscape ? encodeURIComponent(value).replace(/!/g, \"%21\"): notReallyPercentEncode(value);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t};\r\n\tsubFunction.varNames = varNames;\r\n\treturn {\r\n\t\tprefix: prefix,\r\n\t\tsubstitution: subFunction\r\n\t};\r\n}\r\n\r\nfunction UriTemplate(template) {\r\n\tif (!(this instanceof UriTemplate)) {\r\n\t\treturn new UriTemplate(template);\r\n\t}\r\n\tvar parts = template.split(\"{\");\r\n\tvar textParts = [parts.shift()];\r\n\tvar prefixes = [];\r\n\tvar substitutions = [];\r\n\tvar varNames = [];\r\n\twhile (parts.length > 0) {\r\n\t\tvar part = parts.shift();\r\n\t\tvar spec = part.split(\"}\")[0];\r\n\t\tvar remainder = part.substring(spec.length + 1);\r\n\t\tvar funcs = uriTemplateSubstitution(spec);\r\n\t\tsubstitutions.push(funcs.substitution);\r\n\t\tprefixes.push(funcs.prefix);\r\n\t\ttextParts.push(remainder);\r\n\t\tvarNames = varNames.concat(funcs.substitution.varNames);\r\n\t}\r\n\tthis.fill = function (valueFunction) {\r\n\t\tvar result = textParts[0];\r\n\t\tfor (var i = 0; i < substitutions.length; i++) {\r\n\t\t\tvar substitution = substitutions[i];\r\n\t\t\tresult += substitution(valueFunction);\r\n\t\t\tresult += textParts[i + 1];\r\n\t\t}\r\n\t\treturn result;\r\n\t};\r\n\tthis.varNames = varNames;\r\n\tthis.template = template;\r\n}\r\nUriTemplate.prototype = {\r\n\ttoString: function () {\r\n\t\treturn this.template;\r\n\t},\r\n\tfillFromObject: function (obj) {\r\n\t\treturn this.fill(function (varName) {\r\n\t\t\treturn obj[varName];\r\n\t\t});\r\n\t}\r\n};\r\nvar ValidatorContext = function ValidatorContext(parent, collectMultiple, errorReporter, checkRecursive, trackUnknownProperties) {\r\n\tthis.missing = [];\r\n\tthis.missingMap = {};\r\n\tthis.formatValidators = parent ? Object.create(parent.formatValidators) : {};\r\n\tthis.schemas = parent ? Object.create(parent.schemas) : {};\r\n\tthis.collectMultiple = collectMultiple;\r\n\tthis.errors = [];\r\n\tthis.handleError = collectMultiple ? this.collectError : this.returnError;\r\n\tif (checkRecursive) {\r\n\t\tthis.checkRecursive = true;\r\n\t\tthis.scanned = [];\r\n\t\tthis.scannedFrozen = [];\r\n\t\tthis.scannedFrozenSchemas = [];\r\n\t\tthis.scannedFrozenValidationErrors = [];\r\n\t\tthis.validatedSchemasKey = 'tv4_validation_id';\r\n\t\tthis.validationErrorsKey = 'tv4_validation_errors_id';\r\n\t}\r\n\tif (trackUnknownProperties) {\r\n\t\tthis.trackUnknownProperties = true;\r\n\t\tthis.knownPropertyPaths = {};\r\n\t\tthis.unknownPropertyPaths = {};\r\n\t}\r\n\tthis.errorReporter = errorReporter || defaultErrorReporter('en');\r\n\tif (typeof this.errorReporter === 'string') {\r\n\t\tthrow new Error('debug');\r\n\t}\r\n\tthis.definedKeywords = {};\r\n\tif (parent) {\r\n\t\tfor (var key in parent.definedKeywords) {\r\n\t\t\tthis.definedKeywords[key] = parent.definedKeywords[key].slice(0);\r\n\t\t}\r\n\t}\r\n};\r\nValidatorContext.prototype.defineKeyword = function (keyword, keywordFunction) {\r\n\tthis.definedKeywords[keyword] = this.definedKeywords[keyword] || [];\r\n\tthis.definedKeywords[keyword].push(keywordFunction);\r\n};\r\nValidatorContext.prototype.createError = function (code, messageParams, dataPath, schemaPath, subErrors, data, schema) {\r\n\tvar error = new ValidationError(code, messageParams, dataPath, schemaPath, subErrors);\r\n\terror.message = this.errorReporter(error, data, schema);\r\n\treturn error;\r\n};\r\nValidatorContext.prototype.returnError = function (error) {\r\n\treturn error;\r\n};\r\nValidatorContext.prototype.collectError = function (error) {\r\n\tif (error) {\r\n\t\tthis.errors.push(error);\r\n\t}\r\n\treturn null;\r\n};\r\nValidatorContext.prototype.prefixErrors = function (startIndex, dataPath, schemaPath) {\r\n\tfor (var i = startIndex; i < this.errors.length; i++) {\r\n\t\tthis.errors[i] = this.errors[i].prefixWith(dataPath, schemaPath);\r\n\t}\r\n\treturn this;\r\n};\r\nValidatorContext.prototype.banUnknownProperties = function (data, schema) {\r\n\tfor (var unknownPath in this.unknownPropertyPaths) {\r\n\t\tvar error = this.createError(ErrorCodes.UNKNOWN_PROPERTY, {path: unknownPath}, unknownPath, \"\", null, data, schema);\r\n\t\tvar result = this.handleError(error);\r\n\t\tif (result) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.addFormat = function (format, validator) {\r\n\tif (typeof format === 'object') {\r\n\t\tfor (var key in format) {\r\n\t\t\tthis.addFormat(key, format[key]);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\tthis.formatValidators[format] = validator;\r\n};\r\nValidatorContext.prototype.resolveRefs = function (schema, urlHistory) {\r\n\tif (schema['$ref'] !== undefined) {\r\n\t\turlHistory = urlHistory || {};\r\n\t\tif (urlHistory[schema['$ref']]) {\r\n\t\t\treturn this.createError(ErrorCodes.CIRCULAR_REFERENCE, {urls: Object.keys(urlHistory).join(', ')}, '', '', null, undefined, schema);\r\n\t\t}\r\n\t\turlHistory[schema['$ref']] = true;\r\n\t\tschema = this.getSchema(schema['$ref'], urlHistory);\r\n\t}\r\n\treturn schema;\r\n};\r\nValidatorContext.prototype.getSchema = function (url, urlHistory) {\r\n\tvar schema;\r\n\tif (this.schemas[url] !== undefined) {\r\n\t\tschema = this.schemas[url];\r\n\t\treturn this.resolveRefs(schema, urlHistory);\r\n\t}\r\n\tvar baseUrl = url;\r\n\tvar fragment = \"\";\r\n\tif (url.indexOf('#') !== -1) {\r\n\t\tfragment = url.substring(url.indexOf(\"#\") + 1);\r\n\t\tbaseUrl = url.substring(0, url.indexOf(\"#\"));\r\n\t}\r\n\tif (typeof this.schemas[baseUrl] === 'object') {\r\n\t\tschema = this.schemas[baseUrl];\r\n\t\tvar pointerPath = decodeURIComponent(fragment);\r\n\t\tif (pointerPath === \"\") {\r\n\t\t\treturn this.resolveRefs(schema, urlHistory);\r\n\t\t} else if (pointerPath.charAt(0) !== \"/\") {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tvar parts = pointerPath.split(\"/\").slice(1);\r\n\t\tfor (var i = 0; i < parts.length; i++) {\r\n\t\t\tvar component = parts[i].replace(/~1/g, \"/\").replace(/~0/g, \"~\");\r\n\t\t\tif (schema[component] === undefined) {\r\n\t\t\t\tschema = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tschema = schema[component];\r\n\t\t}\r\n\t\tif (schema !== undefined) {\r\n\t\t\treturn this.resolveRefs(schema, urlHistory);\r\n\t\t}\r\n\t}\r\n\tif (this.missing[baseUrl] === undefined) {\r\n\t\tthis.missing.push(baseUrl);\r\n\t\tthis.missing[baseUrl] = baseUrl;\r\n\t\tthis.missingMap[baseUrl] = baseUrl;\r\n\t}\r\n};\r\nValidatorContext.prototype.searchSchemas = function (schema, url) {\r\n\tif (Array.isArray(schema)) {\r\n\t\tfor (var i = 0; i < schema.length; i++) {\r\n\t\t\tthis.searchSchemas(schema[i], url);\r\n\t\t}\r\n\t} else if (schema && typeof schema === \"object\") {\r\n\t\tif (typeof schema.id === \"string\") {\r\n\t\t\tif (isTrustedUrl(url, schema.id)) {\r\n\t\t\t\tif (this.schemas[schema.id] === undefined) {\r\n\t\t\t\t\tthis.schemas[schema.id] = schema;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (var key in schema) {\r\n\t\t\tif (key !== \"enum\") {\r\n\t\t\t\tif (typeof schema[key] === \"object\") {\r\n\t\t\t\t\tthis.searchSchemas(schema[key], url);\r\n\t\t\t\t} else if (key === \"$ref\") {\r\n\t\t\t\t\tvar uri = getDocumentUri(schema[key]);\r\n\t\t\t\t\tif (uri && this.schemas[uri] === undefined && this.missingMap[uri] === undefined) {\r\n\t\t\t\t\t\tthis.missingMap[uri] = uri;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\nValidatorContext.prototype.addSchema = function (url, schema) {\r\n\t//overload\r\n\tif (typeof url !== 'string' || typeof schema === 'undefined') {\r\n\t\tif (typeof url === 'object' && typeof url.id === 'string') {\r\n\t\t\tschema = url;\r\n\t\t\turl = schema.id;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\tif (url === getDocumentUri(url) + \"#\") {\r\n\t\t// Remove empty fragment\r\n\t\turl = getDocumentUri(url);\r\n\t}\r\n\tthis.schemas[url] = schema;\r\n\tdelete this.missingMap[url];\r\n\tnormSchema(schema, url);\r\n\tthis.searchSchemas(schema, url);\r\n};\r\n\r\nValidatorContext.prototype.getSchemaMap = function () {\r\n\tvar map = {};\r\n\tfor (var key in this.schemas) {\r\n\t\tmap[key] = this.schemas[key];\r\n\t}\r\n\treturn map;\r\n};\r\n\r\nValidatorContext.prototype.getSchemaUris = function (filterRegExp) {\r\n\tvar list = [];\r\n\tfor (var key in this.schemas) {\r\n\t\tif (!filterRegExp || filterRegExp.test(key)) {\r\n\t\t\tlist.push(key);\r\n\t\t}\r\n\t}\r\n\treturn list;\r\n};\r\n\r\nValidatorContext.prototype.getMissingUris = function (filterRegExp) {\r\n\tvar list = [];\r\n\tfor (var key in this.missingMap) {\r\n\t\tif (!filterRegExp || filterRegExp.test(key)) {\r\n\t\t\tlist.push(key);\r\n\t\t}\r\n\t}\r\n\treturn list;\r\n};\r\n\r\nValidatorContext.prototype.dropSchemas = function () {\r\n\tthis.schemas = {};\r\n\tthis.reset();\r\n};\r\nValidatorContext.prototype.reset = function () {\r\n\tthis.missing = [];\r\n\tthis.missingMap = {};\r\n\tthis.errors = [];\r\n};\r\n\r\nValidatorContext.prototype.validateAll = function (data, schema, dataPathParts, schemaPathParts, dataPointerPath) {\r\n\tvar topLevel;\r\n\tschema = this.resolveRefs(schema);\r\n\tif (!schema) {\r\n\t\treturn null;\r\n\t} else if (schema instanceof ValidationError) {\r\n\t\tthis.errors.push(schema);\r\n\t\treturn schema;\r\n\t}\r\n\r\n\tvar startErrorCount = this.errors.length;\r\n\tvar frozenIndex, scannedFrozenSchemaIndex = null, scannedSchemasIndex = null;\r\n\tif (this.checkRecursive && data && typeof data === 'object') {\r\n\t\ttopLevel = !this.scanned.length;\r\n\t\tif (data[this.validatedSchemasKey]) {\r\n\t\t\tvar schemaIndex = data[this.validatedSchemasKey].indexOf(schema);\r\n\t\t\tif (schemaIndex !== -1) {\r\n\t\t\t\tthis.errors = this.errors.concat(data[this.validationErrorsKey][schemaIndex]);\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (Object.isFrozen(data)) {\r\n\t\t\tfrozenIndex = this.scannedFrozen.indexOf(data);\r\n\t\t\tif (frozenIndex !== -1) {\r\n\t\t\t\tvar frozenSchemaIndex = this.scannedFrozenSchemas[frozenIndex].indexOf(schema);\r\n\t\t\t\tif (frozenSchemaIndex !== -1) {\r\n\t\t\t\t\tthis.errors = this.errors.concat(this.scannedFrozenValidationErrors[frozenIndex][frozenSchemaIndex]);\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.scanned.push(data);\r\n\t\tif (Object.isFrozen(data)) {\r\n\t\t\tif (frozenIndex === -1) {\r\n\t\t\t\tfrozenIndex = this.scannedFrozen.length;\r\n\t\t\t\tthis.scannedFrozen.push(data);\r\n\t\t\t\tthis.scannedFrozenSchemas.push([]);\r\n\t\t\t}\r\n\t\t\tscannedFrozenSchemaIndex = this.scannedFrozenSchemas[frozenIndex].length;\r\n\t\t\tthis.scannedFrozenSchemas[frozenIndex][scannedFrozenSchemaIndex] = schema;\r\n\t\t\tthis.scannedFrozenValidationErrors[frozenIndex][scannedFrozenSchemaIndex] = [];\r\n\t\t} else {\r\n\t\t\tif (!data[this.validatedSchemasKey]) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tObject.defineProperty(data, this.validatedSchemasKey, {\r\n\t\t\t\t\t\tvalue: [],\r\n\t\t\t\t\t\tconfigurable: true\r\n\t\t\t\t\t});\r\n\t\t\t\t\tObject.defineProperty(data, this.validationErrorsKey, {\r\n\t\t\t\t\t\tvalue: [],\r\n\t\t\t\t\t\tconfigurable: true\r\n\t\t\t\t\t});\r\n\t\t\t\t} catch (e) {\r\n\t\t\t\t\t//IE 7/8 workaround\r\n\t\t\t\t\tdata[this.validatedSchemasKey] = [];\r\n\t\t\t\t\tdata[this.validationErrorsKey] = [];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tscannedSchemasIndex = data[this.validatedSchemasKey].length;\r\n\t\t\tdata[this.validatedSchemasKey][scannedSchemasIndex] = schema;\r\n\t\t\tdata[this.validationErrorsKey][scannedSchemasIndex] = [];\r\n\t\t}\r\n\t}\r\n\r\n\tvar errorCount = this.errors.length;\r\n\tvar error = this.validateBasic(data, schema, dataPointerPath)\r\n\t\t|| this.validateNumeric(data, schema, dataPointerPath)\r\n\t\t|| this.validateString(data, schema, dataPointerPath)\r\n\t\t|| this.validateArray(data, schema, dataPointerPath)\r\n\t\t|| this.validateObject(data, schema, dataPointerPath)\r\n\t\t|| this.validateCombinations(data, schema, dataPointerPath)\r\n\t\t|| this.validateHypermedia(data, schema, dataPointerPath)\r\n\t\t|| this.validateFormat(data, schema, dataPointerPath)\r\n\t\t|| this.validateDefinedKeywords(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n\r\n\tif (topLevel) {\r\n\t\twhile (this.scanned.length) {\r\n\t\t\tvar item = this.scanned.pop();\r\n\t\t\tdelete item[this.validatedSchemasKey];\r\n\t\t}\r\n\t\tthis.scannedFrozen = [];\r\n\t\tthis.scannedFrozenSchemas = [];\r\n\t}\r\n\r\n\tif (error || errorCount !== this.errors.length) {\r\n\t\twhile ((dataPathParts && dataPathParts.length) || (schemaPathParts && schemaPathParts.length)) {\r\n\t\t\tvar dataPart = (dataPathParts && dataPathParts.length) ? \"\" + dataPathParts.pop() : null;\r\n\t\t\tvar schemaPart = (schemaPathParts && schemaPathParts.length) ? \"\" + schemaPathParts.pop() : null;\r\n\t\t\tif (error) {\r\n\t\t\t\terror = error.prefixWith(dataPart, schemaPart);\r\n\t\t\t}\r\n\t\t\tthis.prefixErrors(errorCount, dataPart, schemaPart);\r\n\t\t}\r\n\t}\r\n\r\n\tif (scannedFrozenSchemaIndex !== null) {\r\n\t\tthis.scannedFrozenValidationErrors[frozenIndex][scannedFrozenSchemaIndex] = this.errors.slice(startErrorCount);\r\n\t} else if (scannedSchemasIndex !== null) {\r\n\t\tdata[this.validationErrorsKey][scannedSchemasIndex] = this.errors.slice(startErrorCount);\r\n\t}\r\n\r\n\treturn this.handleError(error);\r\n};\r\nValidatorContext.prototype.validateFormat = function (data, schema) {\r\n\tif (typeof schema.format !== 'string' || !this.formatValidators[schema.format]) {\r\n\t\treturn null;\r\n\t}\r\n\tvar errorMessage = this.formatValidators[schema.format].call(null, data, schema);\r\n\tif (typeof errorMessage === 'string' || typeof errorMessage === 'number') {\r\n\t\treturn this.createError(ErrorCodes.FORMAT_CUSTOM, {message: errorMessage}, '', '/format', null, data, schema);\r\n\t} else if (errorMessage && typeof errorMessage === 'object') {\r\n\t\treturn this.createError(ErrorCodes.FORMAT_CUSTOM, {message: errorMessage.message || \"?\"}, errorMessage.dataPath || '', errorMessage.schemaPath || \"/format\", null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\nValidatorContext.prototype.validateDefinedKeywords = function (data, schema, dataPointerPath) {\r\n\tfor (var key in this.definedKeywords) {\r\n\t\tif (typeof schema[key] === 'undefined') {\r\n\t\t\tcontinue;\r\n\t\t}\r\n\t\tvar validationFunctions = this.definedKeywords[key];\r\n\t\tfor (var i = 0; i < validationFunctions.length; i++) {\r\n\t\t\tvar func = validationFunctions[i];\r\n\t\t\tvar result = func(data, schema[key], schema, dataPointerPath);\r\n\t\t\tif (typeof result === 'string' || typeof result === 'number') {\r\n\t\t\t\treturn this.createError(ErrorCodes.KEYWORD_CUSTOM, {key: key, message: result}, '', '', null, data, schema).prefixWith(null, key);\r\n\t\t\t} else if (result && typeof result === 'object') {\r\n\t\t\t\tvar code = result.code;\r\n\t\t\t\tif (typeof code === 'string') {\r\n\t\t\t\t\tif (!ErrorCodes[code]) {\r\n\t\t\t\t\t\tthrow new Error('Undefined error code (use defineError): ' + code);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcode = ErrorCodes[code];\r\n\t\t\t\t} else if (typeof code !== 'number') {\r\n\t\t\t\t\tcode = ErrorCodes.KEYWORD_CUSTOM;\r\n\t\t\t\t}\r\n\t\t\t\tvar messageParams = (typeof result.message === 'object') ? result.message : {key: key, message: result.message || \"?\"};\r\n\t\t\t\tvar schemaPath = result.schemaPath || (\"/\" + key.replace(/~/g, '~0').replace(/\\//g, '~1'));\r\n\t\t\t\treturn this.createError(code, messageParams, result.dataPath || null, schemaPath, null, data, schema);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nfunction recursiveCompare(A, B) {\r\n\tif (A === B) {\r\n\t\treturn true;\r\n\t}\r\n\tif (A && B && typeof A === \"object\" && typeof B === \"object\") {\r\n\t\tif (Array.isArray(A) !== Array.isArray(B)) {\r\n\t\t\treturn false;\r\n\t\t} else if (Array.isArray(A)) {\r\n\t\t\tif (A.length !== B.length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tfor (var i = 0; i < A.length; i++) {\r\n\t\t\t\tif (!recursiveCompare(A[i], B[i])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar key;\r\n\t\t\tfor (key in A) {\r\n\t\t\t\tif (B[key] === undefined && A[key] !== undefined) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (key in B) {\r\n\t\t\t\tif (A[key] === undefined && B[key] !== undefined) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tfor (key in A) {\r\n\t\t\t\tif (!recursiveCompare(A[key], B[key])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nValidatorContext.prototype.validateBasic = function validateBasic(data, schema, dataPointerPath) {\r\n\tvar error;\r\n\tif (error = this.validateType(data, schema, dataPointerPath)) {\r\n\t\treturn error.prefixWith(null, \"type\");\r\n\t}\r\n\tif (error = this.validateEnum(data, schema, dataPointerPath)) {\r\n\t\treturn error.prefixWith(null, \"type\");\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateType = function validateType(data, schema) {\r\n\tif (schema.type === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar dataType = typeof data;\r\n\tif (data === null) {\r\n\t\tdataType = \"null\";\r\n\t} else if (Array.isArray(data)) {\r\n\t\tdataType = \"array\";\r\n\t}\r\n\tvar allowedTypes = schema.type;\r\n\tif (!Array.isArray(allowedTypes)) {\r\n\t\tallowedTypes = [allowedTypes];\r\n\t}\r\n\r\n\tfor (var i = 0; i < allowedTypes.length; i++) {\r\n\t\tvar type = allowedTypes[i];\r\n\t\tif (type === dataType || (type === \"integer\" && dataType === \"number\" && (data % 1 === 0))) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\treturn this.createError(ErrorCodes.INVALID_TYPE, {type: dataType, expected: allowedTypes.join(\"/\")}, '', '', null, data, schema);\r\n};\r\n\r\nValidatorContext.prototype.validateEnum = function validateEnum(data, schema) {\r\n\tif (schema[\"enum\"] === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tfor (var i = 0; i < schema[\"enum\"].length; i++) {\r\n\t\tvar enumVal = schema[\"enum\"][i];\r\n\t\tif (recursiveCompare(data, enumVal)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\treturn this.createError(ErrorCodes.ENUM_MISMATCH, {value: (typeof JSON !== 'undefined') ? JSON.stringify(data) : data}, '', '', null, data, schema);\r\n};\r\n\r\nValidatorContext.prototype.validateNumeric = function validateNumeric(data, schema, dataPointerPath) {\r\n\treturn this.validateMultipleOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateMinMax(data, schema, dataPointerPath)\r\n\t\t|| this.validateNaN(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nvar CLOSE_ENOUGH_LOW = Math.pow(2, -51);\r\nvar CLOSE_ENOUGH_HIGH = 1 - CLOSE_ENOUGH_LOW;\r\nValidatorContext.prototype.validateMultipleOf = function validateMultipleOf(data, schema) {\r\n\tvar multipleOf = schema.multipleOf || schema.divisibleBy;\r\n\tif (multipleOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tif (typeof data === \"number\") {\r\n\t\tvar remainder = (data/multipleOf)%1;\r\n\t\tif (remainder >= CLOSE_ENOUGH_LOW && remainder < CLOSE_ENOUGH_HIGH) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MULTIPLE_OF, {value: data, multipleOf: multipleOf}, '', '', null, data, schema);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateMinMax = function validateMinMax(data, schema) {\r\n\tif (typeof data !== \"number\") {\r\n\t\treturn null;\r\n\t}\r\n\tif (schema.minimum !== undefined) {\r\n\t\tif (data < schema.minimum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MINIMUM, {value: data, minimum: schema.minimum}, '', '/minimum', null, data, schema);\r\n\t\t}\r\n\t\tif (schema.exclusiveMinimum && data === schema.minimum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MINIMUM_EXCLUSIVE, {value: data, minimum: schema.minimum}, '', '/exclusiveMinimum', null, data, schema);\r\n\t\t}\r\n\t}\r\n\tif (schema.maximum !== undefined) {\r\n\t\tif (data > schema.maximum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MAXIMUM, {value: data, maximum: schema.maximum}, '', '/maximum', null, data, schema);\r\n\t\t}\r\n\t\tif (schema.exclusiveMaximum && data === schema.maximum) {\r\n\t\t\treturn this.createError(ErrorCodes.NUMBER_MAXIMUM_EXCLUSIVE, {value: data, maximum: schema.maximum}, '', '/exclusiveMaximum', null, data, schema);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateNaN = function validateNaN(data, schema) {\r\n\tif (typeof data !== \"number\") {\r\n\t\treturn null;\r\n\t}\r\n\tif (isNaN(data) === true || data === Infinity || data === -Infinity) {\r\n\t\treturn this.createError(ErrorCodes.NUMBER_NOT_A_NUMBER, {value: data}, '', '/type', null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateString = function validateString(data, schema, dataPointerPath) {\r\n\treturn this.validateStringLength(data, schema, dataPointerPath)\r\n\t\t|| this.validateStringPattern(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateStringLength = function validateStringLength(data, schema) {\r\n\tif (typeof data !== \"string\") {\r\n\t\treturn null;\r\n\t}\r\n\tif (schema.minLength !== undefined) {\r\n\t\tif (data.length < schema.minLength) {\r\n\t\t\treturn this.createError(ErrorCodes.STRING_LENGTH_SHORT, {length: data.length, minimum: schema.minLength}, '', '/minLength', null, data, schema);\r\n\t\t}\r\n\t}\r\n\tif (schema.maxLength !== undefined) {\r\n\t\tif (data.length > schema.maxLength) {\r\n\t\t\treturn this.createError(ErrorCodes.STRING_LENGTH_LONG, {length: data.length, maximum: schema.maxLength}, '', '/maxLength', null, data, schema);\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateStringPattern = function validateStringPattern(data, schema) {\r\n\tif (typeof data !== \"string\" || (typeof schema.pattern !== \"string\" && !(schema.pattern instanceof RegExp))) {\r\n\t\treturn null;\r\n\t}\r\n\tvar regexp;\r\n\tif (schema.pattern instanceof RegExp) {\r\n\t  regexp = schema.pattern;\r\n\t}\r\n\telse {\r\n\t  var body, flags = '';\r\n\t  // Check for regular expression literals\r\n\t  // @see http://www.ecma-international.org/ecma-262/5.1/#sec-7.8.5\r\n\t  var literal = schema.pattern.match(/^\\/(.+)\\/([img]*)$/);\r\n\t  if (literal) {\r\n\t    body = literal[1];\r\n\t    flags = literal[2];\r\n\t  }\r\n\t  else {\r\n\t    body = schema.pattern;\r\n\t  }\r\n\t  regexp = new RegExp(body, flags);\r\n\t}\r\n\tif (!regexp.test(data)) {\r\n\t\treturn this.createError(ErrorCodes.STRING_PATTERN, {pattern: schema.pattern}, '', '/pattern', null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateArray = function validateArray(data, schema, dataPointerPath) {\r\n\tif (!Array.isArray(data)) {\r\n\t\treturn null;\r\n\t}\r\n\treturn this.validateArrayLength(data, schema, dataPointerPath)\r\n\t\t|| this.validateArrayUniqueItems(data, schema, dataPointerPath)\r\n\t\t|| this.validateArrayItems(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateArrayLength = function validateArrayLength(data, schema) {\r\n\tvar error;\r\n\tif (schema.minItems !== undefined) {\r\n\t\tif (data.length < schema.minItems) {\r\n\t\t\terror = this.createError(ErrorCodes.ARRAY_LENGTH_SHORT, {length: data.length, minimum: schema.minItems}, '', '/minItems', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (schema.maxItems !== undefined) {\r\n\t\tif (data.length > schema.maxItems) {\r\n\t\t\terror = this.createError(ErrorCodes.ARRAY_LENGTH_LONG, {length: data.length, maximum: schema.maxItems}, '', '/maxItems', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateArrayUniqueItems = function validateArrayUniqueItems(data, schema) {\r\n\tif (schema.uniqueItems) {\r\n\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\tfor (var j = i + 1; j < data.length; j++) {\r\n\t\t\t\tif (recursiveCompare(data[i], data[j])) {\r\n\t\t\t\t\tvar error = this.createError(ErrorCodes.ARRAY_UNIQUE, {match1: i, match2: j}, '', '/uniqueItems', null, data, schema);\r\n\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateArrayItems = function validateArrayItems(data, schema, dataPointerPath) {\r\n\tif (schema.items === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar error, i;\r\n\tif (Array.isArray(schema.items)) {\r\n\t\tfor (i = 0; i < data.length; i++) {\r\n\t\t\tif (i < schema.items.length) {\r\n\t\t\t\tif (error = this.validateAll(data[i], schema.items[i], [i], [\"items\", i], dataPointerPath + \"/\" + i)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t} else if (schema.additionalItems !== undefined) {\r\n\t\t\t\tif (typeof schema.additionalItems === \"boolean\") {\r\n\t\t\t\t\tif (!schema.additionalItems) {\r\n\t\t\t\t\t\terror = (this.createError(ErrorCodes.ARRAY_ADDITIONAL_ITEMS, {}, '/' + i, '/additionalItems', null, data, schema));\r\n\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (error = this.validateAll(data[i], schema.additionalItems, [i], [\"additionalItems\"], dataPointerPath + \"/\" + i)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tfor (i = 0; i < data.length; i++) {\r\n\t\t\tif (error = this.validateAll(data[i], schema.items, [i], [\"items\"], dataPointerPath + \"/\" + i)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObject = function validateObject(data, schema, dataPointerPath) {\r\n\tif (typeof data !== \"object\" || data === null || Array.isArray(data)) {\r\n\t\treturn null;\r\n\t}\r\n\treturn this.validateObjectMinMaxProperties(data, schema, dataPointerPath)\r\n\t\t|| this.validateObjectRequiredProperties(data, schema, dataPointerPath)\r\n\t\t|| this.validateObjectProperties(data, schema, dataPointerPath)\r\n\t\t|| this.validateObjectDependencies(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectMinMaxProperties = function validateObjectMinMaxProperties(data, schema) {\r\n\tvar keys = Object.keys(data);\r\n\tvar error;\r\n\tif (schema.minProperties !== undefined) {\r\n\t\tif (keys.length < schema.minProperties) {\r\n\t\t\terror = this.createError(ErrorCodes.OBJECT_PROPERTIES_MINIMUM, {propertyCount: keys.length, minimum: schema.minProperties}, '', '/minProperties', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (schema.maxProperties !== undefined) {\r\n\t\tif (keys.length > schema.maxProperties) {\r\n\t\t\terror = this.createError(ErrorCodes.OBJECT_PROPERTIES_MAXIMUM, {propertyCount: keys.length, maximum: schema.maxProperties}, '', '/maxProperties', null, data, schema);\r\n\t\t\tif (this.handleError(error)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectRequiredProperties = function validateObjectRequiredProperties(data, schema) {\r\n\tif (schema.required !== undefined) {\r\n\t\tfor (var i = 0; i < schema.required.length; i++) {\r\n\t\t\tvar key = schema.required[i];\r\n\t\t\tif (data[key] === undefined) {\r\n\t\t\t\tvar error = this.createError(ErrorCodes.OBJECT_REQUIRED, {key: key}, '', '/required/' + i, null, data, schema);\r\n\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectProperties = function validateObjectProperties(data, schema, dataPointerPath) {\r\n\tvar error;\r\n\tfor (var key in data) {\r\n\t\tvar keyPointerPath = dataPointerPath + \"/\" + key.replace(/~/g, '~0').replace(/\\//g, '~1');\r\n\t\tvar foundMatch = false;\r\n\t\tif (schema.properties !== undefined && schema.properties[key] !== undefined) {\r\n\t\t\tfoundMatch = true;\r\n\t\t\tif (error = this.validateAll(data[key], schema.properties[key], [key], [\"properties\", key], keyPointerPath)) {\r\n\t\t\t\treturn error;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (schema.patternProperties !== undefined) {\r\n\t\t\tfor (var patternKey in schema.patternProperties) {\r\n\t\t\t\tvar regexp = new RegExp(patternKey);\r\n\t\t\t\tif (regexp.test(key)) {\r\n\t\t\t\t\tfoundMatch = true;\r\n\t\t\t\t\tif (error = this.validateAll(data[key], schema.patternProperties[patternKey], [key], [\"patternProperties\", patternKey], keyPointerPath)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!foundMatch) {\r\n\t\t\tif (schema.additionalProperties !== undefined) {\r\n\t\t\t\tif (this.trackUnknownProperties) {\r\n\t\t\t\t\tthis.knownPropertyPaths[keyPointerPath] = true;\r\n\t\t\t\t\tdelete this.unknownPropertyPaths[keyPointerPath];\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof schema.additionalProperties === \"boolean\") {\r\n\t\t\t\t\tif (!schema.additionalProperties) {\r\n\t\t\t\t\t\terror = this.createError(ErrorCodes.OBJECT_ADDITIONAL_PROPERTIES, {key: key}, '', '/additionalProperties', null, data, schema).prefixWith(key, null);\r\n\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (error = this.validateAll(data[key], schema.additionalProperties, [key], [\"additionalProperties\"], keyPointerPath)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (this.trackUnknownProperties && !this.knownPropertyPaths[keyPointerPath]) {\r\n\t\t\t\tthis.unknownPropertyPaths[keyPointerPath] = true;\r\n\t\t\t}\r\n\t\t} else if (this.trackUnknownProperties) {\r\n\t\t\tthis.knownPropertyPaths[keyPointerPath] = true;\r\n\t\t\tdelete this.unknownPropertyPaths[keyPointerPath];\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateObjectDependencies = function validateObjectDependencies(data, schema, dataPointerPath) {\r\n\tvar error;\r\n\tif (schema.dependencies !== undefined) {\r\n\t\tfor (var depKey in schema.dependencies) {\r\n\t\t\tif (data[depKey] !== undefined) {\r\n\t\t\t\tvar dep = schema.dependencies[depKey];\r\n\t\t\t\tif (typeof dep === \"string\") {\r\n\t\t\t\t\tif (data[dep] === undefined) {\r\n\t\t\t\t\t\terror = this.createError(ErrorCodes.OBJECT_DEPENDENCY_KEY, {key: depKey, missing: dep}, '', '', null, data, schema).prefixWith(null, depKey).prefixWith(null, \"dependencies\");\r\n\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (Array.isArray(dep)) {\r\n\t\t\t\t\tfor (var i = 0; i < dep.length; i++) {\r\n\t\t\t\t\t\tvar requiredKey = dep[i];\r\n\t\t\t\t\t\tif (data[requiredKey] === undefined) {\r\n\t\t\t\t\t\t\terror = this.createError(ErrorCodes.OBJECT_DEPENDENCY_KEY, {key: depKey, missing: requiredKey}, '', '/' + i, null, data, schema).prefixWith(null, depKey).prefixWith(null, \"dependencies\");\r\n\t\t\t\t\t\t\tif (this.handleError(error)) {\r\n\t\t\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (error = this.validateAll(data, dep, [], [\"dependencies\", depKey], dataPointerPath)) {\r\n\t\t\t\t\t\treturn error;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateCombinations = function validateCombinations(data, schema, dataPointerPath) {\r\n\treturn this.validateAllOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateAnyOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateOneOf(data, schema, dataPointerPath)\r\n\t\t|| this.validateNot(data, schema, dataPointerPath)\r\n\t\t|| null;\r\n};\r\n\r\nValidatorContext.prototype.validateAllOf = function validateAllOf(data, schema, dataPointerPath) {\r\n\tif (schema.allOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar error;\r\n\tfor (var i = 0; i < schema.allOf.length; i++) {\r\n\t\tvar subSchema = schema.allOf[i];\r\n\t\tif (error = this.validateAll(data, subSchema, [], [\"allOf\", i], dataPointerPath)) {\r\n\t\t\treturn error;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateAnyOf = function validateAnyOf(data, schema, dataPointerPath) {\r\n\tif (schema.anyOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar errors = [];\r\n\tvar startErrorCount = this.errors.length;\r\n\tvar oldUnknownPropertyPaths, oldKnownPropertyPaths;\r\n\tif (this.trackUnknownProperties) {\r\n\t\toldUnknownPropertyPaths = this.unknownPropertyPaths;\r\n\t\toldKnownPropertyPaths = this.knownPropertyPaths;\r\n\t}\r\n\tvar errorAtEnd = true;\r\n\tfor (var i = 0; i < schema.anyOf.length; i++) {\r\n\t\tif (this.trackUnknownProperties) {\r\n\t\t\tthis.unknownPropertyPaths = {};\r\n\t\t\tthis.knownPropertyPaths = {};\r\n\t\t}\r\n\t\tvar subSchema = schema.anyOf[i];\r\n\r\n\t\tvar errorCount = this.errors.length;\r\n\t\tvar error = this.validateAll(data, subSchema, [], [\"anyOf\", i], dataPointerPath);\r\n\r\n\t\tif (error === null && errorCount === this.errors.length) {\r\n\t\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\r\n\t\t\tif (this.trackUnknownProperties) {\r\n\t\t\t\tfor (var knownKey in this.knownPropertyPaths) {\r\n\t\t\t\t\toldKnownPropertyPaths[knownKey] = true;\r\n\t\t\t\t\tdelete oldUnknownPropertyPaths[knownKey];\r\n\t\t\t\t}\r\n\t\t\t\tfor (var unknownKey in this.unknownPropertyPaths) {\r\n\t\t\t\t\tif (!oldKnownPropertyPaths[unknownKey]) {\r\n\t\t\t\t\t\toldUnknownPropertyPaths[unknownKey] = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t// We need to continue looping so we catch all the property definitions, but we don't want to return an error\r\n\t\t\t\terrorAtEnd = false;\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\tif (error) {\r\n\t\t\terrors.push(error.prefixWith(null, \"\" + i).prefixWith(null, \"anyOf\"));\r\n\t\t}\r\n\t}\r\n\tif (this.trackUnknownProperties) {\r\n\t\tthis.unknownPropertyPaths = oldUnknownPropertyPaths;\r\n\t\tthis.knownPropertyPaths = oldKnownPropertyPaths;\r\n\t}\r\n\tif (errorAtEnd) {\r\n\t\terrors = errors.concat(this.errors.slice(startErrorCount));\r\n\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\treturn this.createError(ErrorCodes.ANY_OF_MISSING, {}, \"\", \"/anyOf\", errors, data, schema);\r\n\t}\r\n};\r\n\r\nValidatorContext.prototype.validateOneOf = function validateOneOf(data, schema, dataPointerPath) {\r\n\tif (schema.oneOf === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar validIndex = null;\r\n\tvar errors = [];\r\n\tvar startErrorCount = this.errors.length;\r\n\tvar oldUnknownPropertyPaths, oldKnownPropertyPaths;\r\n\tif (this.trackUnknownProperties) {\r\n\t\toldUnknownPropertyPaths = this.unknownPropertyPaths;\r\n\t\toldKnownPropertyPaths = this.knownPropertyPaths;\r\n\t}\r\n\tfor (var i = 0; i < schema.oneOf.length; i++) {\r\n\t\tif (this.trackUnknownProperties) {\r\n\t\t\tthis.unknownPropertyPaths = {};\r\n\t\t\tthis.knownPropertyPaths = {};\r\n\t\t}\r\n\t\tvar subSchema = schema.oneOf[i];\r\n\r\n\t\tvar errorCount = this.errors.length;\r\n\t\tvar error = this.validateAll(data, subSchema, [], [\"oneOf\", i], dataPointerPath);\r\n\r\n\t\tif (error === null && errorCount === this.errors.length) {\r\n\t\t\tif (validIndex === null) {\r\n\t\t\t\tvalidIndex = i;\r\n\t\t\t} else {\r\n\t\t\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\t\t\treturn this.createError(ErrorCodes.ONE_OF_MULTIPLE, {index1: validIndex, index2: i}, \"\", \"/oneOf\", null, data, schema);\r\n\t\t\t}\r\n\t\t\tif (this.trackUnknownProperties) {\r\n\t\t\t\tfor (var knownKey in this.knownPropertyPaths) {\r\n\t\t\t\t\toldKnownPropertyPaths[knownKey] = true;\r\n\t\t\t\t\tdelete oldUnknownPropertyPaths[knownKey];\r\n\t\t\t\t}\r\n\t\t\t\tfor (var unknownKey in this.unknownPropertyPaths) {\r\n\t\t\t\t\tif (!oldKnownPropertyPaths[unknownKey]) {\r\n\t\t\t\t\t\toldUnknownPropertyPaths[unknownKey] = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (error) {\r\n\t\t\terrors.push(error);\r\n\t\t}\r\n\t}\r\n\tif (this.trackUnknownProperties) {\r\n\t\tthis.unknownPropertyPaths = oldUnknownPropertyPaths;\r\n\t\tthis.knownPropertyPaths = oldKnownPropertyPaths;\r\n\t}\r\n\tif (validIndex === null) {\r\n\t\terrors = errors.concat(this.errors.slice(startErrorCount));\r\n\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t\treturn this.createError(ErrorCodes.ONE_OF_MISSING, {}, \"\", \"/oneOf\", errors, data, schema);\r\n\t} else {\r\n\t\tthis.errors = this.errors.slice(0, startErrorCount);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateNot = function validateNot(data, schema, dataPointerPath) {\r\n\tif (schema.not === undefined) {\r\n\t\treturn null;\r\n\t}\r\n\tvar oldErrorCount = this.errors.length;\r\n\tvar oldUnknownPropertyPaths, oldKnownPropertyPaths;\r\n\tif (this.trackUnknownProperties) {\r\n\t\toldUnknownPropertyPaths = this.unknownPropertyPaths;\r\n\t\toldKnownPropertyPaths = this.knownPropertyPaths;\r\n\t\tthis.unknownPropertyPaths = {};\r\n\t\tthis.knownPropertyPaths = {};\r\n\t}\r\n\tvar error = this.validateAll(data, schema.not, null, null, dataPointerPath);\r\n\tvar notErrors = this.errors.slice(oldErrorCount);\r\n\tthis.errors = this.errors.slice(0, oldErrorCount);\r\n\tif (this.trackUnknownProperties) {\r\n\t\tthis.unknownPropertyPaths = oldUnknownPropertyPaths;\r\n\t\tthis.knownPropertyPaths = oldKnownPropertyPaths;\r\n\t}\r\n\tif (error === null && notErrors.length === 0) {\r\n\t\treturn this.createError(ErrorCodes.NOT_PASSED, {}, \"\", \"/not\", null, data, schema);\r\n\t}\r\n\treturn null;\r\n};\r\n\r\nValidatorContext.prototype.validateHypermedia = function validateCombinations(data, schema, dataPointerPath) {\r\n\tif (!schema.links) {\r\n\t\treturn null;\r\n\t}\r\n\tvar error;\r\n\tfor (var i = 0; i < schema.links.length; i++) {\r\n\t\tvar ldo = schema.links[i];\r\n\t\tif (ldo.rel === \"describedby\") {\r\n\t\t\tvar template = new UriTemplate(ldo.href);\r\n\t\t\tvar allPresent = true;\r\n\t\t\tfor (var j = 0; j < template.varNames.length; j++) {\r\n\t\t\t\tif (!(template.varNames[j] in data)) {\r\n\t\t\t\t\tallPresent = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (allPresent) {\r\n\t\t\t\tvar schemaUrl = template.fillFromObject(data);\r\n\t\t\t\tvar subSchema = {\"$ref\": schemaUrl};\r\n\t\t\t\tif (error = this.validateAll(data, subSchema, [], [\"links\", i], dataPointerPath)) {\r\n\t\t\t\t\treturn error;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n// parseURI() and resolveUrl() are from https://gist.github.com/1088850\r\n//   -  released as public domain by author (\"Yaffle\") - see comments on gist\r\n\r\nfunction parseURI(url) {\r\n\tvar m = String(url).replace(/^\\s+|\\s+$/g, '').match(/^([^:\\/?#]+:)?(\\/\\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\\/?#]*)(?::(\\d*))?))?([^?#]*)(\\?[^#]*)?(#[\\s\\S]*)?/);\r\n\t// authority = '//' + user + ':' + pass '@' + hostname + ':' port\r\n\treturn (m ? {\r\n\t\thref     : m[0] || '',\r\n\t\tprotocol : m[1] || '',\r\n\t\tauthority: m[2] || '',\r\n\t\thost     : m[3] || '',\r\n\t\thostname : m[4] || '',\r\n\t\tport     : m[5] || '',\r\n\t\tpathname : m[6] || '',\r\n\t\tsearch   : m[7] || '',\r\n\t\thash     : m[8] || ''\r\n\t} : null);\r\n}\r\n\r\nfunction resolveUrl(base, href) {// RFC 3986\r\n\r\n\tfunction removeDotSegments(input) {\r\n\t\tvar output = [];\r\n\t\tinput.replace(/^(\\.\\.?(\\/|$))+/, '')\r\n\t\t\t.replace(/\\/(\\.(\\/|$))+/g, '/')\r\n\t\t\t.replace(/\\/\\.\\.$/, '/../')\r\n\t\t\t.replace(/\\/?[^\\/]*/g, function (p) {\r\n\t\t\t\tif (p === '/..') {\r\n\t\t\t\t\toutput.pop();\r\n\t\t\t\t} else {\r\n\t\t\t\t\toutput.push(p);\r\n\t\t\t\t}\r\n\t\t});\r\n\t\treturn output.join('').replace(/^\\//, input.charAt(0) === '/' ? '/' : '');\r\n\t}\r\n\r\n\thref = parseURI(href || '');\r\n\tbase = parseURI(base || '');\r\n\r\n\treturn !href || !base ? null : (href.protocol || base.protocol) +\r\n\t\t(href.protocol || href.authority ? href.authority : base.authority) +\r\n\t\tremoveDotSegments(href.protocol || href.authority || href.pathname.charAt(0) === '/' ? href.pathname : (href.pathname ? ((base.authority && !base.pathname ? '/' : '') + base.pathname.slice(0, base.pathname.lastIndexOf('/') + 1) + href.pathname) : base.pathname)) +\r\n\t\t(href.protocol || href.authority || href.pathname ? href.search : (href.search || base.search)) +\r\n\t\thref.hash;\r\n}\r\n\r\nfunction getDocumentUri(uri) {\r\n\treturn uri.split('#')[0];\r\n}\r\nfunction normSchema(schema, baseUri) {\r\n\tif (schema && typeof schema === \"object\") {\r\n\t\tif (baseUri === undefined) {\r\n\t\t\tbaseUri = schema.id;\r\n\t\t} else if (typeof schema.id === \"string\") {\r\n\t\t\tbaseUri = resolveUrl(baseUri, schema.id);\r\n\t\t\tschema.id = baseUri;\r\n\t\t}\r\n\t\tif (Array.isArray(schema)) {\r\n\t\t\tfor (var i = 0; i < schema.length; i++) {\r\n\t\t\t\tnormSchema(schema[i], baseUri);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (typeof schema['$ref'] === \"string\") {\r\n\t\t\t\tschema['$ref'] = resolveUrl(baseUri, schema['$ref']);\r\n\t\t\t}\r\n\t\t\tfor (var key in schema) {\r\n\t\t\t\tif (key !== \"enum\") {\r\n\t\t\t\t\tnormSchema(schema[key], baseUri);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction defaultErrorReporter(language) {\r\n\tlanguage = language || 'en';\r\n\r\n\tvar errorMessages = languages[language];\r\n\r\n\treturn function (error) {\r\n\t\tvar messageTemplate = errorMessages[error.code] || ErrorMessagesDefault[error.code];\r\n\t\tif (typeof messageTemplate !== 'string') {\r\n\t\t\treturn \"Unknown error code \" + error.code + \": \" + JSON.stringify(error.messageParams);\r\n\t\t}\r\n\t\tvar messageParams = error.params;\r\n\t\t// Adapted from Crockford's supplant()\r\n\t\treturn messageTemplate.replace(/\\{([^{}]*)\\}/g, function (whole, varName) {\r\n\t\t\tvar subValue = messageParams[varName];\r\n\t\t\treturn typeof subValue === 'string' || typeof subValue === 'number' ? subValue : whole;\r\n\t\t});\r\n\t};\r\n}\r\n\r\nvar ErrorCodes = {\r\n\tINVALID_TYPE: 0,\r\n\tENUM_MISMATCH: 1,\r\n\tANY_OF_MISSING: 10,\r\n\tONE_OF_MISSING: 11,\r\n\tONE_OF_MULTIPLE: 12,\r\n\tNOT_PASSED: 13,\r\n\t// Numeric errors\r\n\tNUMBER_MULTIPLE_OF: 100,\r\n\tNUMBER_MINIMUM: 101,\r\n\tNUMBER_MINIMUM_EXCLUSIVE: 102,\r\n\tNUMBER_MAXIMUM: 103,\r\n\tNUMBER_MAXIMUM_EXCLUSIVE: 104,\r\n\tNUMBER_NOT_A_NUMBER: 105,\r\n\t// String errors\r\n\tSTRING_LENGTH_SHORT: 200,\r\n\tSTRING_LENGTH_LONG: 201,\r\n\tSTRING_PATTERN: 202,\r\n\t// Object errors\r\n\tOBJECT_PROPERTIES_MINIMUM: 300,\r\n\tOBJECT_PROPERTIES_MAXIMUM: 301,\r\n\tOBJECT_REQUIRED: 302,\r\n\tOBJECT_ADDITIONAL_PROPERTIES: 303,\r\n\tOBJECT_DEPENDENCY_KEY: 304,\r\n\t// Array errors\r\n\tARRAY_LENGTH_SHORT: 400,\r\n\tARRAY_LENGTH_LONG: 401,\r\n\tARRAY_UNIQUE: 402,\r\n\tARRAY_ADDITIONAL_ITEMS: 403,\r\n\t// Custom/user-defined errors\r\n\tFORMAT_CUSTOM: 500,\r\n\tKEYWORD_CUSTOM: 501,\r\n\t// Schema structure\r\n\tCIRCULAR_REFERENCE: 600,\r\n\t// Non-standard validation options\r\n\tUNKNOWN_PROPERTY: 1000\r\n};\r\nvar ErrorCodeLookup = {};\r\nfor (var key in ErrorCodes) {\r\n\tErrorCodeLookup[ErrorCodes[key]] = key;\r\n}\r\nvar ErrorMessagesDefault = {\r\n\tINVALID_TYPE: \"Invalid type: {type} (expected {expected})\",\r\n\tENUM_MISMATCH: \"No enum match for: {value}\",\r\n\tANY_OF_MISSING: \"Data does not match any schemas from \\\"anyOf\\\"\",\r\n\tONE_OF_MISSING: \"Data does not match any schemas from \\\"oneOf\\\"\",\r\n\tONE_OF_MULTIPLE: \"Data is valid against more than one schema from \\\"oneOf\\\": indices {index1} and {index2}\",\r\n\tNOT_PASSED: \"Data matches schema from \\\"not\\\"\",\r\n\t// Numeric errors\r\n\tNUMBER_MULTIPLE_OF: \"Value {value} is not a multiple of {multipleOf}\",\r\n\tNUMBER_MINIMUM: \"Value {value} is less than minimum {minimum}\",\r\n\tNUMBER_MINIMUM_EXCLUSIVE: \"Value {value} is equal to exclusive minimum {minimum}\",\r\n\tNUMBER_MAXIMUM: \"Value {value} is greater than maximum {maximum}\",\r\n\tNUMBER_MAXIMUM_EXCLUSIVE: \"Value {value} is equal to exclusive maximum {maximum}\",\r\n\tNUMBER_NOT_A_NUMBER: \"Value {value} is not a valid number\",\r\n\t// String errors\r\n\tSTRING_LENGTH_SHORT: \"String is too short ({length} chars), minimum {minimum}\",\r\n\tSTRING_LENGTH_LONG: \"String is too long ({length} chars), maximum {maximum}\",\r\n\tSTRING_PATTERN: \"String does not match pattern: {pattern}\",\r\n\t// Object errors\r\n\tOBJECT_PROPERTIES_MINIMUM: \"Too few properties defined ({propertyCount}), minimum {minimum}\",\r\n\tOBJECT_PROPERTIES_MAXIMUM: \"Too many properties defined ({propertyCount}), maximum {maximum}\",\r\n\tOBJECT_REQUIRED: \"Missing required property: {key}\",\r\n\tOBJECT_ADDITIONAL_PROPERTIES: \"Additional properties not allowed\",\r\n\tOBJECT_DEPENDENCY_KEY: \"Dependency failed - key must exist: {missing} (due to key: {key})\",\r\n\t// Array errors\r\n\tARRAY_LENGTH_SHORT: \"Array is too short ({length}), minimum {minimum}\",\r\n\tARRAY_LENGTH_LONG: \"Array is too long ({length}), maximum {maximum}\",\r\n\tARRAY_UNIQUE: \"Array items are not unique (indices {match1} and {match2})\",\r\n\tARRAY_ADDITIONAL_ITEMS: \"Additional items not allowed\",\r\n\t// Format errors\r\n\tFORMAT_CUSTOM: \"Format validation failed ({message})\",\r\n\tKEYWORD_CUSTOM: \"Keyword failed: {key} ({message})\",\r\n\t// Schema structure\r\n\tCIRCULAR_REFERENCE: \"Circular $refs: {urls}\",\r\n\t// Non-standard validation options\r\n\tUNKNOWN_PROPERTY: \"Unknown property (not in schema)\"\r\n};\r\n\r\nfunction ValidationError(code, params, dataPath, schemaPath, subErrors) {\r\n\tError.call(this);\r\n\tif (code === undefined) {\r\n\t\tthrow new Error (\"No error code supplied: \" + schemaPath);\r\n\t}\r\n\tthis.message = '';\r\n\tthis.params = params;\r\n\tthis.code = code;\r\n\tthis.dataPath = dataPath || \"\";\r\n\tthis.schemaPath = schemaPath || \"\";\r\n\tthis.subErrors = subErrors || null;\r\n\r\n\tvar err = new Error(this.message);\r\n\tthis.stack = err.stack || err.stacktrace;\r\n\tif (!this.stack) {\r\n\t\ttry {\r\n\t\t\tthrow err;\r\n\t\t}\r\n\t\tcatch(err) {\r\n\t\t\tthis.stack = err.stack || err.stacktrace;\r\n\t\t}\r\n\t}\r\n}\r\nValidationError.prototype = Object.create(Error.prototype);\r\nValidationError.prototype.constructor = ValidationError;\r\nValidationError.prototype.name = 'ValidationError';\r\n\r\nValidationError.prototype.prefixWith = function (dataPrefix, schemaPrefix) {\r\n\tif (dataPrefix !== null) {\r\n\t\tdataPrefix = dataPrefix.replace(/~/g, \"~0\").replace(/\\//g, \"~1\");\r\n\t\tthis.dataPath = \"/\" + dataPrefix + this.dataPath;\r\n\t}\r\n\tif (schemaPrefix !== null) {\r\n\t\tschemaPrefix = schemaPrefix.replace(/~/g, \"~0\").replace(/\\//g, \"~1\");\r\n\t\tthis.schemaPath = \"/\" + schemaPrefix + this.schemaPath;\r\n\t}\r\n\tif (this.subErrors !== null) {\r\n\t\tfor (var i = 0; i < this.subErrors.length; i++) {\r\n\t\t\tthis.subErrors[i].prefixWith(dataPrefix, schemaPrefix);\r\n\t\t}\r\n\t}\r\n\treturn this;\r\n};\r\n\r\nfunction isTrustedUrl(baseUrl, testUrl) {\r\n\tif(testUrl.substring(0, baseUrl.length) === baseUrl){\r\n\t\tvar remainder = testUrl.substring(baseUrl.length);\r\n\t\tif ((testUrl.length > 0 && testUrl.charAt(baseUrl.length - 1) === \"/\")\r\n\t\t\t|| remainder.charAt(0) === \"#\"\r\n\t\t\t|| remainder.charAt(0) === \"?\") {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nvar languages = {};\r\nfunction createApi(language) {\r\n\tvar globalContext = new ValidatorContext();\r\n\tvar currentLanguage;\r\n\tvar customErrorReporter;\r\n\tvar api = {\r\n\t\tsetErrorReporter: function (reporter) {\r\n\t\t\tif (typeof reporter === 'string') {\r\n\t\t\t\treturn this.language(reporter);\r\n\t\t\t}\r\n\t\t\tcustomErrorReporter = reporter;\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\taddFormat: function () {\r\n\t\t\tglobalContext.addFormat.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tlanguage: function (code) {\r\n\t\t\tif (!code) {\r\n\t\t\t\treturn currentLanguage;\r\n\t\t\t}\r\n\t\t\tif (!languages[code]) {\r\n\t\t\t\tcode = code.split('-')[0]; // fall back to base language\r\n\t\t\t}\r\n\t\t\tif (languages[code]) {\r\n\t\t\t\tcurrentLanguage = code;\r\n\t\t\t\treturn code; // so you can tell if fall-back has happened\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\taddLanguage: function (code, messageMap) {\r\n\t\t\tvar key;\r\n\t\t\tfor (key in ErrorCodes) {\r\n\t\t\t\tif (messageMap[key] && !messageMap[ErrorCodes[key]]) {\r\n\t\t\t\t\tmessageMap[ErrorCodes[key]] = messageMap[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvar rootCode = code.split('-')[0];\r\n\t\t\tif (!languages[rootCode]) { // use for base language if not yet defined\r\n\t\t\t\tlanguages[code] = messageMap;\r\n\t\t\t\tlanguages[rootCode] = messageMap;\r\n\t\t\t} else {\r\n\t\t\t\tlanguages[code] = Object.create(languages[rootCode]);\r\n\t\t\t\tfor (key in messageMap) {\r\n\t\t\t\t\tif (typeof languages[rootCode][key] === 'undefined') {\r\n\t\t\t\t\t\tlanguages[rootCode][key] = messageMap[key];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlanguages[code][key] = messageMap[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tfreshApi: function (language) {\r\n\t\t\tvar result = createApi();\r\n\t\t\tif (language) {\r\n\t\t\t\tresult.language(language);\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tvalidate: function (data, schema, checkRecursive, banUnknownProperties) {\r\n\t\t\tvar def = defaultErrorReporter(currentLanguage);\r\n\t\t\tvar errorReporter = customErrorReporter ? function (error, data, schema) {\r\n\t\t\t\treturn customErrorReporter(error, data, schema) || def(error, data, schema);\r\n\t\t\t} : def;\r\n\t\t\tvar context = new ValidatorContext(globalContext, false, errorReporter, checkRecursive, banUnknownProperties);\r\n\t\t\tif (typeof schema === \"string\") {\r\n\t\t\t\tschema = {\"$ref\": schema};\r\n\t\t\t}\r\n\t\t\tcontext.addSchema(\"\", schema);\r\n\t\t\tvar error = context.validateAll(data, schema, null, null, \"\");\r\n\t\t\tif (!error && banUnknownProperties) {\r\n\t\t\t\terror = context.banUnknownProperties(data, schema);\r\n\t\t\t}\r\n\t\t\tthis.error = error;\r\n\t\t\tthis.missing = context.missing;\r\n\t\t\tthis.valid = (error === null);\r\n\t\t\treturn this.valid;\r\n\t\t},\r\n\t\tvalidateResult: function () {\r\n\t\t\tvar result = {toString: function () {\r\n\t\t\t\treturn this.valid ? 'valid' : this.error.message;\r\n\t\t\t}};\r\n\t\t\tthis.validate.apply(result, arguments);\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\tvalidateMultiple: function (data, schema, checkRecursive, banUnknownProperties) {\r\n\t\t\tvar def = defaultErrorReporter(currentLanguage);\r\n\t\t\tvar errorReporter = customErrorReporter ? function (error, data, schema) {\r\n\t\t\t\treturn customErrorReporter(error, data, schema) || def(error, data, schema);\r\n\t\t\t} : def;\r\n\t\t\tvar context = new ValidatorContext(globalContext, true, errorReporter, checkRecursive, banUnknownProperties);\r\n\t\t\tif (typeof schema === \"string\") {\r\n\t\t\t\tschema = {\"$ref\": schema};\r\n\t\t\t}\r\n\t\t\tcontext.addSchema(\"\", schema);\r\n\t\t\tcontext.validateAll(data, schema, null, null, \"\");\r\n\t\t\tif (banUnknownProperties) {\r\n\t\t\t\tcontext.banUnknownProperties(data, schema);\r\n\t\t\t}\r\n\t\t\tvar result = {toString: function () {\r\n\t\t\t\treturn this.valid ? 'valid' : this.error.message;\r\n\t\t\t}};\r\n\t\t\tresult.errors = context.errors;\r\n\t\t\tresult.missing = context.missing;\r\n\t\t\tresult.valid = (result.errors.length === 0);\r\n\t\t\treturn result;\r\n\t\t},\r\n\t\taddSchema: function () {\r\n\t\t\treturn globalContext.addSchema.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetSchema: function () {\r\n\t\t\treturn globalContext.getSchema.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetSchemaMap: function () {\r\n\t\t\treturn globalContext.getSchemaMap.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetSchemaUris: function () {\r\n\t\t\treturn globalContext.getSchemaUris.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tgetMissingUris: function () {\r\n\t\t\treturn globalContext.getMissingUris.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tdropSchemas: function () {\r\n\t\t\tglobalContext.dropSchemas.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tdefineKeyword: function () {\r\n\t\t\tglobalContext.defineKeyword.apply(globalContext, arguments);\r\n\t\t},\r\n\t\tdefineError: function (codeName, codeNumber, defaultMessage) {\r\n\t\t\tif (typeof codeName !== 'string' || !/^[A-Z]+(_[A-Z]+)*$/.test(codeName)) {\r\n\t\t\t\tthrow new Error('Code name must be a string in UPPER_CASE_WITH_UNDERSCORES');\r\n\t\t\t}\r\n\t\t\tif (typeof codeNumber !== 'number' || codeNumber%1 !== 0 || codeNumber < 10000) {\r\n\t\t\t\tthrow new Error('Code number must be an integer > 10000');\r\n\t\t\t}\r\n\t\t\tif (typeof ErrorCodes[codeName] !== 'undefined') {\r\n\t\t\t\tthrow new Error('Error already defined: ' + codeName + ' as ' + ErrorCodes[codeName]);\r\n\t\t\t}\r\n\t\t\tif (typeof ErrorCodeLookup[codeNumber] !== 'undefined') {\r\n\t\t\t\tthrow new Error('Error code already used: ' + ErrorCodeLookup[codeNumber] + ' as ' + codeNumber);\r\n\t\t\t}\r\n\t\t\tErrorCodes[codeName] = codeNumber;\r\n\t\t\tErrorCodeLookup[codeNumber] = codeName;\r\n\t\t\tErrorMessagesDefault[codeName] = ErrorMessagesDefault[codeNumber] = defaultMessage;\r\n\t\t\tfor (var langCode in languages) {\r\n\t\t\t\tvar language = languages[langCode];\r\n\t\t\t\tif (language[codeName]) {\r\n\t\t\t\t\tlanguage[codeNumber] = language[codeNumber] || language[codeName];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\treset: function () {\r\n\t\t\tglobalContext.reset();\r\n\t\t\tthis.error = null;\r\n\t\t\tthis.missing = [];\r\n\t\t\tthis.valid = true;\r\n\t\t},\r\n\t\tmissing: [],\r\n\t\terror: null,\r\n\t\tvalid: true,\r\n\t\tnormSchema: normSchema,\r\n\t\tresolveUrl: resolveUrl,\r\n\t\tgetDocumentUri: getDocumentUri,\r\n\t\terrorCodes: ErrorCodes\r\n\t};\r\n\tapi.language(language || 'en');\r\n\treturn api;\r\n}\r\n\r\nvar tv4 = createApi();\r\ntv4.addLanguage('en-gb', ErrorMessagesDefault);\r\n\r\n//legacy property\r\ntv4.tv4 = tv4;\r\n\r\nreturn tv4; // used by _header.js to globalise.\r\n\r\n}));"],"names":["subscriber_queue","writable","value","start","noop","stop","subscribers","set","new_value","safe_not_equal","run_queue","length","i","s","push","update","fn","subscribe","run","invalidate","subscriber","index","indexOf","splice","format_url","url","include_hash","hash","pathname","search","get_location_url","href","location","slice","URL","origin","__assign","Object","assign","t","n","arguments","p","prototype","hasOwnProperty","call","apply","this","overlay","store","read","write","updater","component","options","_a","_b","readonly","_c","replace","LocationOptions","get_value","on_start","on_popstate","event","window","addEventListener","removeEventListener","set_value","history","replaceState","pushState","state","PopStateEvent","dispatchEvent","update_location_url","query_param","key","default_value","QueryParamOptions","params","URLSearchParams","has","get","searchParams","delete","toString","storage","adapter","undefined","event_source","prefix","StorageOptions","stored_value","getItem","JSON","parse","on_change","StorageEvent","detail","storageArea","newValue","removeItem","setItem","stringify","global","localStorage","sessionStorage","factory","module","exports","tv4","hasDontEnumBug","dontEnums","dontEnumsLength","keys","propertyIsEnumerable","obj","TypeError","result","prop","create","F","o","Error","Array","isArray","vArg","searchElement","len","Number","Infinity","Math","floor","abs","k","max","isFrozen","random","e","uriTemplateGlobalModifiers","+","#",".","/",";","?","&","uriTemplateSuffices","*","notReallyPercentEncode","string","encodeURI","doubleEncoded","substring","uriTemplateSubstitution","spec","modifier","charAt","separator","shouldEscape","showVariables","trimEmptyString","varNames","varList","split","varSpecs","varName","truncate","parts","parseInt","suffices","varSpec","name","subFunction","valueFunction","startIndex","j","encodeURIComponent","first","substitution","UriTemplate","template","textParts","shift","prefixes","substitutions","part","remainder","funcs","concat","fill","fillFromObject","ValidatorContext","parent","collectMultiple","errorReporter","checkRecursive","trackUnknownProperties","missing","missingMap","formatValidators","schemas","errors","handleError","collectError","returnError","scanned","scannedFrozen","scannedFrozenSchemas","scannedFrozenValidationErrors","validatedSchemasKey","validationErrorsKey","knownPropertyPaths","unknownPropertyPaths","defaultErrorReporter","definedKeywords","recursiveCompare","A","B","defineKeyword","keyword","keywordFunction","createError","code","messageParams","dataPath","schemaPath","subErrors","data","schema","error","ValidationError","message","prefixErrors","prefixWith","banUnknownProperties","unknownPath","ErrorCodes","UNKNOWN_PROPERTY","path","addFormat","format","validator","resolveRefs","urlHistory","CIRCULAR_REFERENCE","urls","join","getSchema","baseUrl","fragment","pointerPath","decodeURIComponent","searchSchemas","id","testUrl","isTrustedUrl","uri","getDocumentUri","addSchema","normSchema","getSchemaMap","map","getSchemaUris","filterRegExp","list","test","getMissingUris","dropSchemas","reset","validateAll","dataPathParts","schemaPathParts","dataPointerPath","topLevel","frozenIndex","startErrorCount","scannedFrozenSchemaIndex","scannedSchemasIndex","schemaIndex","frozenSchemaIndex","defineProperty","configurable","errorCount","validateBasic","validateNumeric","validateString","validateArray","validateObject","validateCombinations","validateHypermedia","validateFormat","validateDefinedKeywords","pop","dataPart","schemaPart","errorMessage","FORMAT_CUSTOM","validationFunctions","func","KEYWORD_CUSTOM","validateType","validateEnum","type","dataType","allowedTypes","INVALID_TYPE","expected","ENUM_MISMATCH","validateMultipleOf","validateMinMax","validateNaN","CLOSE_ENOUGH_LOW","pow","CLOSE_ENOUGH_HIGH","parseURI","m","String","match","protocol","authority","host","hostname","port","resolveUrl","base","input","lastIndexOf","output","baseUri","language","errorMessages","languages","messageTemplate","ErrorMessagesDefault","whole","subValue","multipleOf","divisibleBy","NUMBER_MULTIPLE_OF","minimum","NUMBER_MINIMUM","exclusiveMinimum","NUMBER_MINIMUM_EXCLUSIVE","maximum","NUMBER_MAXIMUM","exclusiveMaximum","NUMBER_MAXIMUM_EXCLUSIVE","isNaN","NUMBER_NOT_A_NUMBER","validateStringLength","validateStringPattern","minLength","STRING_LENGTH_SHORT","maxLength","STRING_LENGTH_LONG","pattern","RegExp","regexp","body","flags","literal","STRING_PATTERN","validateArrayLength","validateArrayUniqueItems","validateArrayItems","minItems","ARRAY_LENGTH_SHORT","maxItems","ARRAY_LENGTH_LONG","uniqueItems","ARRAY_UNIQUE","match1","match2","items","additionalItems","ARRAY_ADDITIONAL_ITEMS","validateObjectMinMaxProperties","validateObjectRequiredProperties","validateObjectProperties","validateObjectDependencies","minProperties","OBJECT_PROPERTIES_MINIMUM","propertyCount","maxProperties","OBJECT_PROPERTIES_MAXIMUM","required","OBJECT_REQUIRED","keyPointerPath","foundMatch","properties","patternProperties","patternKey","additionalProperties","OBJECT_ADDITIONAL_PROPERTIES","dependencies","depKey","dep","OBJECT_DEPENDENCY_KEY","requiredKey","validateAllOf","validateAnyOf","validateOneOf","validateNot","allOf","subSchema","anyOf","oldUnknownPropertyPaths","oldKnownPropertyPaths","errorAtEnd","knownKey","unknownKey","ANY_OF_MISSING","oneOf","validIndex","ONE_OF_MULTIPLE","index1","index2","ONE_OF_MISSING","not","oldErrorCount","notErrors","NOT_PASSED","links","ldo","rel","allPresent","$ref","ErrorCodeLookup","err","stack","stacktrace","constructor","dataPrefix","schemaPrefix","createApi","currentLanguage","customErrorReporter","globalContext","api","setErrorReporter","reporter","addLanguage","messageMap","rootCode","freshApi","validate","def","context","valid","validateResult","validateMultiple","defineError","codeName","codeNumber","defaultMessage","langCode","errorCodes"],"mappings":"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"}